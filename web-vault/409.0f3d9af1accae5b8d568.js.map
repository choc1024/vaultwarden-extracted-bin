{"version":3,"file":"409.0f3d9af1accae5b8d568.js","mappings":"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","sources":["webpack://@bitwarden/web-vault/../../libs/importer/src/components/dialog/import-error-dialog.component.html","webpack://@bitwarden/web-vault/../../libs/importer/src/components/dialog/import-error-dialog.component.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/components/dialog/import-success-dialog.component.html","webpack://@bitwarden/web-vault/../../libs/importer/src/components/dialog/import-success-dialog.component.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/components/dialog/file-password-prompt.component.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/components/dialog/file-password-prompt.component.html","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/enums/idp-provider.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/enums/lastpass-login-type.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/enums/otp-method.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/enums/platform.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/models/account.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/models/chunk.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/models/client-info.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/models/exported-account.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/models/federated-user-context.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/models/oob-result.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/models/otp-result.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/models/parser-options.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/models/session.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/models/shared-folder.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/models/user-type-context.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/services/binary-reader.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/services/rest-client.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/services/client.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/services/crypto-utils.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/services/parser.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/importers/lastpass/access/vault.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/components/lastpass/dialog/lastpass-password-prompt.component.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/components/lastpass/dialog/lastpass-password-prompt.component.html","webpack://@bitwarden/web-vault/../../libs/importer/src/components/lastpass/dialog/lastpass-multifactor-prompt.component.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/components/lastpass/dialog/lastpass-multifactor-prompt.component.html","webpack://@bitwarden/web-vault/../../libs/importer/src/components/lastpass/lastpass-direct-import-ui.service.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/components/lastpass/lastpass-direct-import.service.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/components/lastpass/import-lastpass.component.ts","webpack://@bitwarden/web-vault/../../libs/importer/src/components/lastpass/import-lastpass.component.html","webpack://@bitwarden/web-vault/../../libs/importer/src/components/import.component.html","webpack://@bitwarden/web-vault/../../libs/importer/src/components/import.component.ts"],"sourcesContent":["<bit-dialog>\n  <span bitDialogTitle>\n    {{ \"importError\" | i18n }}\n  </span>\n\n  <span bitDialogContent>\n    <div>{{ \"resolveTheErrorsBelowAndTryAgain\" | i18n }}</div>\n    <bit-table [dataSource]=\"dataSource\">\n      <ng-container header>\n        <tr>\n          <th bitCell>{{ \"name\" | i18n }}</th>\n          <th bitCell>{{ \"description\" | i18n }}</th>\n        </tr>\n      </ng-container>\n      <ng-template body let-rows$>\n        <tr bitRow *ngFor=\"let r of rows$ | async\">\n          <td bitCell>{{ r.type }}</td>\n          <td bitCell>{{ r.message }}</td>\n        </tr>\n      </ng-template>\n    </bit-table>\n  </span>\n\n  <div bitDialogFooter>\n    <button bitButton bitDialogClose buttonType=\"primary\" type=\"button\">\n      {{ \"ok\" | i18n }}\n    </button>\n  </div>\n</bit-dialog>\n","import { DialogRef, DIALOG_DATA } from \"@angular/cdk/dialog\";\nimport { CommonModule } from \"@angular/common\";\nimport { Component, Inject, OnInit } from \"@angular/core\";\n\nimport { JslibModule } from \"@bitwarden/angular/jslib.module\";\nimport { ButtonModule, DialogModule, TableDataSource, TableModule } from \"@bitwarden/components\";\n\nexport interface ErrorListItem {\n  type: string;\n  message: string;\n}\n\n@Component({\n  templateUrl: \"./import-error-dialog.component.html\",\n  standalone: true,\n  imports: [CommonModule, JslibModule, DialogModule, TableModule, ButtonModule],\n})\nexport class ImportErrorDialogComponent implements OnInit {\n  protected dataSource = new TableDataSource<ErrorListItem>();\n\n  constructor(\n    public dialogRef: DialogRef,\n    @Inject(DIALOG_DATA) public data: Error,\n  ) {}\n\n  ngOnInit(): void {\n    const split = this.data.message.split(\"\\n\\n\");\n    if (split.length == 1) {\n      this.dataSource.data = [{ type: \"\", message: this.data.message }];\n      return;\n    }\n\n    const data: ErrorListItem[] = [];\n    split.forEach((line) => {\n      data.push({ type: \"\", message: line });\n    });\n    this.dataSource.data = data;\n  }\n}\n","<bit-dialog>\n  <span bitDialogTitle>\n    {{ \"importSuccess\" | i18n }}\n  </span>\n\n  <div bitDialogContent>\n    <span>{{ \"importSuccessNumberOfItems\" | i18n: this.data.ciphers.length }}</span>\n    <bit-table [dataSource]=\"dataSource\">\n      <ng-container header>\n        <tr>\n          <th bitCell>{{ \"type\" | i18n }}</th>\n          <th bitCell>{{ \"total\" | i18n }}</th>\n        </tr>\n      </ng-container>\n      <ng-template body let-rows$>\n        <tr bitRow *ngFor=\"let r of rows$ | async\">\n          <td bitCell>\n            <i class=\"bwi bwi-fw bwi-{{ r.icon }}\" aria-hidden=\"true\"></i>\n            {{ r.type | i18n }}\n          </td>\n          <td bitCell>{{ r.count }}</td>\n        </tr>\n      </ng-template>\n    </bit-table>\n  </div>\n\n  <ng-container bitDialogFooter>\n    <button bitButton bitDialogClose buttonType=\"primary\" type=\"button\">\n      {{ \"ok\" | i18n }}\n    </button>\n  </ng-container>\n</bit-dialog>\n","import { DialogRef, DIALOG_DATA } from \"@angular/cdk/dialog\";\nimport { CommonModule } from \"@angular/common\";\nimport { Component, Inject, OnInit } from \"@angular/core\";\n\nimport { JslibModule } from \"@bitwarden/angular/jslib.module\";\nimport { CipherType } from \"@bitwarden/common/vault/enums\";\nimport { ButtonModule, DialogModule, TableDataSource, TableModule } from \"@bitwarden/components\";\n\nimport { ImportResult } from \"../../models\";\n\nexport interface ResultList {\n  icon: string;\n  type: string;\n  count: number;\n}\n\n@Component({\n  templateUrl: \"./import-success-dialog.component.html\",\n  standalone: true,\n  imports: [CommonModule, JslibModule, DialogModule, TableModule, ButtonModule],\n})\nexport class ImportSuccessDialogComponent implements OnInit {\n  protected dataSource = new TableDataSource<ResultList>();\n\n  constructor(\n    public dialogRef: DialogRef,\n    @Inject(DIALOG_DATA) public data: ImportResult,\n  ) {}\n\n  ngOnInit(): void {\n    if (this.data != null) {\n      this.dataSource.data = this.buildResultList();\n    }\n  }\n\n  private buildResultList(): ResultList[] {\n    let logins = 0;\n    let cards = 0;\n    let identities = 0;\n    let secureNotes = 0;\n    this.data.ciphers.map((c) => {\n      switch (c.type) {\n        case CipherType.Login:\n          logins++;\n          break;\n        case CipherType.Card:\n          cards++;\n          break;\n        case CipherType.SecureNote:\n          secureNotes++;\n          break;\n        case CipherType.Identity:\n          identities++;\n          break;\n        default:\n          break;\n      }\n    });\n\n    const list: ResultList[] = [];\n    if (logins > 0) {\n      list.push({ icon: \"globe\", type: \"typeLogin\", count: logins });\n    }\n    if (cards > 0) {\n      list.push({ icon: \"credit-card\", type: \"typeCard\", count: cards });\n    }\n    if (identities > 0) {\n      list.push({ icon: \"id-card\", type: \"typeIdentity\", count: identities });\n    }\n    if (secureNotes > 0) {\n      list.push({ icon: \"sticky-note\", type: \"typeSecureNote\", count: secureNotes });\n    }\n    if (this.data.folders.length > 0) {\n      list.push({ icon: \"folder\", type: \"folders\", count: this.data.folders.length });\n    }\n    if (this.data.collections.length > 0) {\n      list.push({\n        icon: \"collection\",\n        type: \"collections\",\n        count: this.data.collections.length,\n      });\n    }\n    return list;\n  }\n}\n","import { DialogRef } from \"@angular/cdk/dialog\";\nimport { CommonModule } from \"@angular/common\";\nimport { Component } from \"@angular/core\";\nimport { FormBuilder, ReactiveFormsModule, Validators } from \"@angular/forms\";\n\nimport { JslibModule } from \"@bitwarden/angular/jslib.module\";\nimport {\n  AsyncActionsModule,\n  ButtonModule,\n  DialogModule,\n  FormFieldModule,\n  IconButtonModule,\n} from \"@bitwarden/components\";\n\n@Component({\n  templateUrl: \"file-password-prompt.component.html\",\n  standalone: true,\n  imports: [\n    CommonModule,\n    JslibModule,\n    DialogModule,\n    FormFieldModule,\n    AsyncActionsModule,\n    ButtonModule,\n    IconButtonModule,\n    ReactiveFormsModule,\n  ],\n})\nexport class FilePasswordPromptComponent {\n  protected formGroup = this.formBuilder.group({\n    filePassword: [\"\", Validators.required],\n  });\n\n  constructor(\n    public dialogRef: DialogRef,\n    protected formBuilder: FormBuilder,\n  ) {}\n\n  submit = () => {\n    this.formGroup.markAsTouched();\n    if (!this.formGroup.valid) {\n      return;\n    }\n    this.dialogRef.close(this.formGroup.value.filePassword);\n  };\n}\n","<form [formGroup]=\"formGroup\" [bitSubmit]=\"submit\">\n  <bit-dialog>\n    <span bitDialogTitle>\n      {{ \"confirmVaultImport\" | i18n }}\n    </span>\n\n    <div bitDialogContent>\n      {{ \"confirmVaultImportDesc\" | i18n }}\n      <bit-form-field class=\"tw-mt-6\">\n        <bit-label>{{ \"confirmFilePassword\" | i18n }}</bit-label>\n        <input\n          bitInput\n          type=\"password\"\n          formControlName=\"filePassword\"\n          appAutofocus\n          appInputVerbatim\n        />\n        <button type=\"button\" bitSuffix bitIconButton bitPasswordInputToggle></button>\n      </bit-form-field>\n    </div>\n\n    <ng-container bitDialogFooter>\n      <button bitButton buttonType=\"primary\" type=\"submit\">\n        <span>{{ \"importData\" | i18n }}</span>\n      </button>\n      <button bitButton bitDialogClose buttonType=\"secondary\" type=\"button\">\n        <span>{{ \"cancel\" | i18n }}</span>\n      </button>\n    </ng-container>\n  </bit-dialog>\n</form>\n","export enum IdpProvider {\n  Azure = 0,\n  OktaAuthServer = 1,\n  OktaNoAuthServer = 2,\n  Google = 3,\n  PingOne = 4,\n  OneLogin = 5,\n}\n","export enum LastpassLoginType {\n  MasterPassword = 0,\n  // Not sure what Types 1 and 2 are?\n  Federated = 3,\n}\n","export enum OtpMethod {\n  GoogleAuth,\n  MicrosoftAuth,\n  Yubikey,\n}\n","export enum Platform {\n  Desktop,\n  Mobile,\n}\n","export class Account {\n  id: string;\n  name: string;\n  username: string;\n  password: string;\n  url: string;\n  path: string;\n  notes: string;\n  totp: string;\n  isFavorite: boolean;\n  isShared: boolean;\n}\n","export class Chunk {\n  id: string;\n  payload: Uint8Array;\n}\n","import { Platform } from \"../enums\";\n\nexport class ClientInfo {\n  platform: Platform;\n  id: string;\n  description: string;\n\n  static createClientInfo(id: string): ClientInfo {\n    return { platform: Platform.Desktop, id, description: \"Importer\" };\n  }\n}\n","import { Account } from \"./account\";\n\nexport class ExportedAccount {\n  url: string;\n  username: string;\n  password: string;\n  totp: string;\n  extra: string;\n  name: string;\n  grouping: string;\n  fav: number;\n\n  constructor(account: Account) {\n    this.url = account.url;\n    this.username = account.username;\n    this.password = account.password;\n    this.totp = account.totp;\n    this.extra = account.notes;\n    this.name = account.name;\n    this.grouping = account.path === \"(none)\" ? null : account.path;\n    this.fav = account.isFavorite ? 1 : 0;\n  }\n}\n","export class FederatedUserContext {\n  username: string;\n  idpUserInfo: any;\n  accessToken: string;\n  idToken: string;\n}\n","export class OobResult {\n  static cancel = new OobResult(false, \"cancel\", false);\n\n  constructor(\n    public waitForOutOfBand: boolean,\n    public passcode: string,\n    public rememberMe: boolean,\n  ) {}\n\n  waitForApproval(rememberMe: boolean) {\n    return new OobResult(true, \"\", rememberMe);\n  }\n\n  continueWithPasscode(passcode: string, rememberMe: boolean) {\n    return new OobResult(false, passcode, rememberMe);\n  }\n}\n","export class OtpResult {\n  static cancel = new OtpResult(\"cancel\", false);\n\n  constructor(\n    public passcode: string,\n    public rememberMe: boolean,\n  ) {}\n}\n","export class ParserOptions {\n  static default: ParserOptions = new ParserOptions();\n  parseSecureNotesToAccount = true;\n}\n","import { Platform } from \"../enums\";\n\nexport class Session {\n  id: string;\n  keyIterationCount: number;\n  token: string;\n  platform: Platform;\n  encryptedPrivateKey: string;\n}\n","export class SharedFolder {\n  id: string;\n  name: string;\n  encryptionKey: Uint8Array;\n}\n","import { IdpProvider, LastpassLoginType } from \"../enums\";\n\nexport class UserTypeContext {\n  type: LastpassLoginType;\n  identityProviderGUID: string;\n  identityProviderURL: string;\n  openIDConnectAuthority: string;\n  openIDConnectClientId: string;\n  companyId: number;\n  provider: IdpProvider;\n  pkceEnabled: boolean;\n  isPasswordlessEnabled: boolean;\n\n  isFederated(): boolean {\n    return (\n      this.type === LastpassLoginType.Federated &&\n      this.hasValue(this.identityProviderURL) &&\n      this.hasValue(this.openIDConnectAuthority) &&\n      this.hasValue(this.openIDConnectClientId)\n    );\n  }\n\n  get oidcScope(): string {\n    let scope = \"openid profile email\";\n    if (this.provider === IdpProvider.PingOne) {\n      scope += \" lastpass\";\n    }\n    return scope;\n  }\n\n  get openIDConnectAuthorityBase(): string {\n    return this.openIDConnectAuthority.replace(\"/.well-known/openid-configuration\", \"\");\n  }\n\n  private hasValue(str: string) {\n    return str != null && str.trim() !== \"\";\n  }\n}\n","export class BinaryReader {\n  private position: number;\n  private isLittleEndian: boolean;\n\n  constructor(public arr: Uint8Array) {\n    this.position = 0;\n\n    const uInt32 = new Uint32Array([0x11223344]);\n    const uInt8 = new Uint8Array(uInt32.buffer);\n    this.isLittleEndian = uInt8[0] === 0x44;\n  }\n\n  readBytes(count: number): Uint8Array {\n    if (this.position + count > this.arr.length) {\n      throw new Error(\"End of array reached\");\n    }\n    const slice = this.arr.subarray(this.position, this.position + count);\n    this.position += count;\n    return slice;\n  }\n\n  readUInt16(): number {\n    const slice = this.readBytes(2);\n    const int = slice[0] | (slice[1] << 8);\n    // Convert to unsigned int\n    return int >>> 0;\n  }\n\n  readUInt32(): number {\n    const slice = this.readBytes(4);\n    const int = slice[0] | (slice[1] << 8) | (slice[2] << 16) | (slice[3] << 24);\n    // Convert to unsigned int\n    return int >>> 0;\n  }\n\n  readUInt16BigEndian(): number {\n    let result = this.readUInt16();\n    if (this.isLittleEndian) {\n      // Extract the two bytes\n      const byte1 = result & 0xff;\n      const byte2 = (result >> 8) & 0xff;\n      // Create a big-endian value by swapping the bytes\n      result = (byte1 << 8) | byte2;\n    }\n    return result;\n  }\n\n  readUInt32BigEndian(): number {\n    let result = this.readUInt32();\n    if (this.isLittleEndian) {\n      // Extract individual bytes\n      const byte1 = (result >> 24) & 0xff;\n      const byte2 = (result >> 16) & 0xff;\n      const byte3 = (result >> 8) & 0xff;\n      const byte4 = result & 0xff;\n      // Create a big-endian value by reordering the bytes\n      result = (byte4 << 24) | (byte3 << 16) | (byte2 << 8) | byte1;\n    }\n    return result;\n  }\n\n  seekFromCurrentPosition(offset: number) {\n    const newPosition = this.position + offset;\n    if (newPosition < 0) {\n      throw new Error(\"Position cannot be negative\");\n    }\n    if (newPosition > this.arr.length) {\n      throw new Error(\"Array not large enough to seek to this position\");\n    }\n    this.position = newPosition;\n  }\n\n  atEnd(): boolean {\n    return this.position >= this.arr.length - 1;\n  }\n}\n","export class RestClient {\n  baseUrl: string;\n  isBrowser = true;\n\n  async get(\n    endpoint: string,\n    headers: Map<string, string> = null,\n    cookies: Map<string, string> = null,\n  ): Promise<Response> {\n    const requestInit: RequestInit = {\n      method: \"GET\",\n      credentials: \"include\",\n    };\n    this.setHeaders(requestInit, headers, cookies);\n    const request = new Request(this.baseUrl + \"/\" + endpoint, requestInit);\n    const response = await fetch(request);\n    return response;\n  }\n\n  async postForm(\n    endpoint: string,\n    parameters: Map<string, any> = null,\n    headers: Map<string, string> = null,\n    cookies: Map<string, string> = null,\n  ): Promise<Response> {\n    const setBody = (requestInit: RequestInit, headerMap: Map<string, string>) => {\n      if (parameters != null && parameters.size > 0) {\n        const form = new FormData();\n        for (const [key, value] of parameters) {\n          form.set(key, value);\n        }\n        requestInit.body = form;\n      }\n    };\n    return await this.post(endpoint, setBody, headers, cookies);\n  }\n\n  async postJson(\n    endpoint: string,\n    body: any,\n    headers: Map<string, string> = null,\n    cookies: Map<string, string> = null,\n  ): Promise<Response> {\n    const setBody = (requestInit: RequestInit, headerMap: Map<string, string>) => {\n      if (body != null) {\n        headerMap.set(\"Content-Type\", \"application/json; charset=utf-8\");\n        requestInit.body = JSON.stringify(body);\n      }\n    };\n    return await this.post(endpoint, setBody, headers, cookies);\n  }\n\n  private async post(\n    endpoint: string,\n    setBody: (requestInit: RequestInit, headers: Map<string, string>) => void,\n    headers: Map<string, string> = null,\n    cookies: Map<string, string> = null,\n  ) {\n    const requestInit: RequestInit = {\n      method: \"POST\",\n      credentials: \"include\",\n    };\n    if (headers == null) {\n      headers = new Map<string, string>();\n    }\n    setBody(requestInit, headers);\n    this.setHeaders(requestInit, headers, cookies);\n    const request = new Request(this.baseUrl + \"/\" + endpoint, requestInit);\n    const response = await fetch(request);\n    return response;\n  }\n\n  private setHeaders(\n    requestInit: RequestInit,\n    headers: Map<string, string> = null,\n    cookies: Map<string, string> = null,\n  ) {\n    const requestHeaders = new Headers();\n    let setHeaders = false;\n    if (headers != null && headers.size > 0) {\n      setHeaders = true;\n      for (const [key, value] of headers) {\n        requestHeaders.set(key, value);\n      }\n    }\n    // Cookies should be already automatically set for this origin by the browser\n    // TODO: set cookies for non-browser scenarios?\n    if (!this.isBrowser && cookies != null && cookies.size > 0) {\n      setHeaders = true;\n      const cookieString = Array.from(cookies.keys())\n        .map((key) => `${key}=${cookies.get(key)}`)\n        .join(\"; \");\n      requestHeaders.set(\"cookie\", cookieString);\n    }\n    if (setHeaders) {\n      requestInit.headers = requestHeaders;\n    }\n  }\n}\n","import { HttpStatusCode } from \"@bitwarden/common/enums\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\n\nimport { OtpMethod, Platform } from \"../enums\";\nimport {\n  Account,\n  Chunk,\n  ClientInfo,\n  OobResult,\n  OtpResult,\n  ParserOptions,\n  Session,\n  SharedFolder,\n} from \"../models\";\nimport { Ui } from \"../ui\";\n\nimport { BinaryReader } from \"./binary-reader\";\nimport { CryptoUtils } from \"./crypto-utils\";\nimport { Parser } from \"./parser\";\nimport { RestClient } from \"./rest-client\";\n\nconst PlatformToUserAgent = new Map<Platform, string>([\n  [Platform.Desktop, \"cli\"],\n  [Platform.Mobile, \"android\"],\n]);\n\nconst KnownOtpMethods = new Map<string, OtpMethod>([\n  [\"googleauthrequired\", OtpMethod.GoogleAuth],\n  [\"microsoftauthrequired\", OtpMethod.MicrosoftAuth],\n  [\"otprequired\", OtpMethod.Yubikey],\n]);\n\nexport class Client {\n  constructor(\n    private parser: Parser,\n    private cryptoUtils: CryptoUtils,\n  ) {}\n\n  async openVault(\n    username: string,\n    password: string,\n    fragmentId: string,\n    clientInfo: ClientInfo,\n    ui: Ui,\n    options: ParserOptions,\n  ): Promise<Account[]> {\n    const lowercaseUsername = username.toLowerCase();\n    const [session, rest] = await this.login(\n      lowercaseUsername,\n      password,\n      fragmentId,\n      clientInfo,\n      ui,\n    );\n    try {\n      const blob = await this.downloadVault(session, rest);\n      const key = await this.cryptoUtils.deriveKey(\n        lowercaseUsername,\n        password,\n        session.keyIterationCount,\n      );\n\n      let privateKey: Uint8Array = null;\n      if (session.encryptedPrivateKey != null && session.encryptedPrivateKey != \"\") {\n        privateKey = await this.parser.parseEncryptedPrivateKey(session.encryptedPrivateKey, key);\n      }\n\n      return this.parseVault(blob, key, privateKey, options);\n    } finally {\n      await this.logout(session, rest);\n    }\n  }\n\n  private async parseVault(\n    blob: Uint8Array,\n    encryptionKey: Uint8Array,\n    privateKey: Uint8Array,\n    options: ParserOptions,\n  ): Promise<Account[]> {\n    const reader = new BinaryReader(blob);\n    const chunks = this.parser.extractChunks(reader);\n    if (!this.isComplete(chunks)) {\n      throw new Error(\"Blob is truncated or corrupted\");\n    }\n    return await this.parseAccounts(chunks, encryptionKey, privateKey, options);\n  }\n\n  private async parseAccounts(\n    chunks: Chunk[],\n    encryptionKey: Uint8Array,\n    privateKey: Uint8Array,\n    options: ParserOptions,\n  ): Promise<Account[]> {\n    const accounts = new Array<Account>();\n    let folder: SharedFolder = null;\n    for (const chunk of chunks) {\n      if (chunk.id === \"ACCT\") {\n        const key = folder == null ? encryptionKey : folder.encryptionKey;\n        const account = await this.parser.parseAcct(chunk, key, folder, options);\n        if (account != null) {\n          accounts.push(account);\n        }\n      } else if (chunk.id === \"SHAR\") {\n        folder = await this.parser.parseShar(chunk, encryptionKey, privateKey);\n      }\n    }\n    return accounts;\n  }\n\n  private isComplete(chunks: Chunk[]): boolean {\n    if (chunks.length > 0 && chunks[chunks.length - 1].id === \"ENDM\") {\n      const okChunk = Utils.fromBufferToUtf8(chunks[chunks.length - 1].payload);\n      return okChunk === \"OK\";\n    }\n    return false;\n  }\n\n  private async login(\n    username: string,\n    password: string,\n    fragmentId: string,\n    clientInfo: ClientInfo,\n    ui: Ui,\n  ): Promise<[Session, RestClient]> {\n    const rest = new RestClient();\n    rest.baseUrl = \"https://lastpass.com\";\n\n    /*\n    1. First we need to request PBKDF2 key iteration count.\n    \n    We no longer request the iteration count from the server in a separate request because it\n    started to fail in weird ways. It seems there's a special combination or the UA and cookies\n    that returns the correct result. And that is not 100% reliable. After two or three attempts\n    it starts to fail again with an incorrect result.\n    \n    So we just went back a few years to the original way LastPass used to handle the iterations.\n    Namely, submit the default value and if it fails, the error would contain the correct value:\n    <response><error iterations=\"5000\" /></response>\n    */\n    let keyIterationCount = 100_100;\n\n    let response: Document = null;\n    let session: Session = null;\n\n    // We have a maximum of 3 retries in case we need to try again with the correct domain and/or\n    // the number of KDF iterations the second/third time around.\n    for (let i = 0; i < 3; i++) {\n      // 2. Knowing the iterations count we can hash the password and log in.\n      // On the first attempt simply with the username and password.\n      response = await this.performSingleLoginRequest(\n        username,\n        password,\n        fragmentId,\n        keyIterationCount,\n        new Map<string, any>(),\n        clientInfo,\n        rest,\n      );\n\n      session = this.extractSessionFromLoginResponse(response, keyIterationCount, clientInfo);\n      if (session != null) {\n        return [session, rest];\n      }\n\n      // It's possible we're being redirected to another region.\n      const server = this.getOptionalErrorAttribute(response, \"server\");\n      if (server != null && server.trim() != \"\") {\n        rest.baseUrl = \"https://\" + server;\n        continue;\n      }\n\n      // It's possible for the request above to come back with the correct iteration count.\n      // In this case we have to parse and repeat.\n      const correctIterationCount = this.getOptionalErrorAttribute(response, \"iterations\");\n      if (correctIterationCount == null) {\n        break;\n      }\n\n      try {\n        keyIterationCount = parseInt(correctIterationCount);\n      } catch {\n        throw (\n          \"Failed to parse the iteration count, expected an integer value '\" +\n          correctIterationCount +\n          \"'\"\n        );\n      }\n    }\n\n    // 3. The simple login failed. This is usually due to some error, invalid credentials or\n    // a multifactor authentication being enabled.\n    const cause = this.getOptionalErrorAttribute(response, \"cause\");\n    if (cause == null) {\n      throw this.makeLoginError(response);\n    }\n\n    const optMethod = KnownOtpMethods.get(cause);\n    if (optMethod != null) {\n      // 3.1. One-time-password is required\n      session = await this.loginWithOtp(\n        username,\n        password,\n        fragmentId,\n        keyIterationCount,\n        optMethod,\n        clientInfo,\n        ui,\n        rest,\n      );\n    } else if (cause === \"outofbandrequired\") {\n      // 3.2. Some out-of-bound authentication is enabled. This does not require any\n      // additional input from the user.\n      session = await this.loginWithOob(\n        username,\n        password,\n        fragmentId,\n        keyIterationCount,\n        this.getAllErrorAttributes(response),\n        clientInfo,\n        ui,\n        rest,\n      );\n    }\n\n    // Nothing worked\n    if (session == null) {\n      throw this.makeLoginError(response);\n    }\n\n    // All good\n    return [session, rest];\n  }\n\n  private async loginWithOtp(\n    username: string,\n    password: string,\n    fragmentId: string,\n    keyIterationCount: number,\n    method: OtpMethod,\n    clientInfo: ClientInfo,\n    ui: Ui,\n    rest: RestClient,\n  ): Promise<Session> {\n    let passcode: OtpResult = null;\n    switch (method) {\n      case OtpMethod.GoogleAuth:\n        passcode = await ui.provideGoogleAuthPasscode();\n        break;\n      case OtpMethod.MicrosoftAuth:\n        passcode = await ui.provideMicrosoftAuthPasscode();\n        break;\n      case OtpMethod.Yubikey:\n        passcode = await ui.provideYubikeyPasscode();\n        break;\n      default:\n        throw new Error(\"Invalid OTP method\");\n    }\n\n    if (passcode == OtpResult.cancel) {\n      throw new Error(\"Second factor step is canceled by the user\");\n    }\n\n    const response = await this.performSingleLoginRequest(\n      username,\n      password,\n      fragmentId,\n      keyIterationCount,\n      new Map<string, string>([[\"otp\", passcode.passcode]]),\n      clientInfo,\n      rest,\n    );\n\n    const session = this.extractSessionFromLoginResponse(response, keyIterationCount, clientInfo);\n    if (session == null) {\n      throw this.makeLoginError(response);\n    }\n    if (passcode.rememberMe) {\n      await this.markDeviceAsTrusted(session, clientInfo, rest);\n    }\n    return session;\n  }\n\n  private async loginWithOob(\n    username: string,\n    password: string,\n    fragmentId: string,\n    keyIterationCount: number,\n    parameters: Map<string, string>,\n    clientInfo: ClientInfo,\n    ui: Ui,\n    rest: RestClient,\n  ): Promise<Session> {\n    // In case of the OOB auth the server doesn't respond instantly. This works more like a long poll.\n    // The server times out in about 10 seconds so there's no need to back off.\n    const attemptLogin = async (extraParameters: Map<string, any>): Promise<Session> => {\n      const response = await this.performSingleLoginRequest(\n        username,\n        password,\n        fragmentId,\n        keyIterationCount,\n        extraParameters,\n        clientInfo,\n        rest,\n      );\n\n      const session = this.extractSessionFromLoginResponse(response, keyIterationCount, clientInfo);\n      if (session != null) {\n        return session;\n      }\n\n      if (this.getOptionalErrorAttribute(response, \"cause\") != \"outofbandrequired\") {\n        throw this.makeLoginError(response);\n      }\n\n      // Retry\n      extraParameters.set(\"outofbandretry\", \"1\");\n      extraParameters.set(\"outofbandretryid\", this.getErrorAttribute(response, \"retryid\"));\n\n      return attemptLogin(extraParameters);\n    };\n\n    const pollingLoginSession = () => {\n      const extraParameters = new Map<string, any>();\n      extraParameters.set(\"outofbandrequest\", 1);\n      return attemptLogin(extraParameters);\n    };\n\n    const passcodeLoginSession = async () => {\n      const answer = await this.approveOob(username, parameters, ui, rest);\n\n      if (answer == OobResult.cancel) {\n        throw new Error(\"Out of band step is canceled by the user\");\n      }\n      const extraParameters = new Map<string, any>();\n      extraParameters.set(\"otp\", answer.passcode);\n      const session = await attemptLogin(extraParameters);\n      if (answer.rememberMe) {\n        await this.markDeviceAsTrusted(session, clientInfo, rest);\n      }\n      return session;\n    };\n\n    const session: Session = await Promise.race([\n      pollingLoginSession(),\n      passcodeLoginSession(),\n    ]).finally(() => {\n      ui.closeMFADialog();\n    });\n    return session;\n  }\n\n  private async approveOob(\n    username: string,\n    parameters: Map<string, string>,\n    ui: Ui,\n    rest: RestClient,\n  ): Promise<OobResult> {\n    const method = parameters.get(\"outofbandtype\");\n    if (method == null) {\n      throw new Error(\"Out of band method is not specified\");\n    }\n    switch (method) {\n      case \"lastpassauth\":\n        return ui.approveLastPassAuth();\n      case \"duo\":\n        return this.approveDuo(username, parameters, ui, rest);\n      case \"salesforcehash\":\n        return ui.approveSalesforceAuth();\n      default:\n        throw new Error(\"Out of band method \" + method + \" is not supported\");\n    }\n  }\n\n  private async approveDuo(\n    username: string,\n    parameters: Map<string, string>,\n    ui: Ui,\n    rest: RestClient,\n  ): Promise<OobResult> {\n    return parameters.get(\"preferduowebsdk\") == \"1\"\n      ? this.approveDuoWebSdk(username, parameters, ui, rest)\n      : ui.approveDuo();\n  }\n\n  private approveDuoWebSdk(\n    username: string,\n    parameters: Map<string, string>,\n    ui: Ui,\n    rest: RestClient,\n  ): Promise<OobResult> {\n    // TODO: implement this instead of calling `approveDuo`\n    return ui.approveDuo();\n  }\n\n  private async markDeviceAsTrusted(session: Session, clientInfo: ClientInfo, rest: RestClient) {\n    const parameters = new Map<string, string>([\n      [\"uuid\", clientInfo.id],\n      [\"trustlabel\", clientInfo.description],\n      [\"token\", session.token],\n    ]);\n    const response = await rest.postForm(\n      \"trust.php\",\n      parameters,\n      null,\n      this.getSessionCookies(session),\n    );\n    if (response.status == HttpStatusCode.Ok) {\n      return;\n    }\n    this.makeError(response);\n  }\n\n  private async logout(session: Session, rest: RestClient) {\n    const parameters = new Map<string, any>([\n      [\"method\", PlatformToUserAgent.get(session.platform)],\n      [\"noredirect\", 1],\n    ]);\n    const response = await rest.postForm(\n      \"logout.php\",\n      parameters,\n      null,\n      this.getSessionCookies(session),\n    );\n    if (response.status == HttpStatusCode.Ok) {\n      return;\n    }\n    this.makeError(response);\n  }\n\n  private async downloadVault(session: Session, rest: RestClient): Promise<Uint8Array> {\n    const endpoint =\n      \"getaccts.php?mobile=1&b64=1&hash=0.0&hasplugin=3.0.23&requestsrc=\" +\n      PlatformToUserAgent.get(session.platform);\n    const response = await rest.get(endpoint, null, this.getSessionCookies(session));\n    if (response.status == HttpStatusCode.Ok) {\n      const b64 = await response.text();\n      return Utils.fromB64ToArray(b64);\n    }\n    this.makeError(response);\n  }\n\n  private getSessionCookies(session: Session) {\n    return new Map<string, string>([[\"PHPSESSID\", encodeURIComponent(session.id)]]);\n  }\n\n  private getErrorAttribute(response: Document, name: string): string {\n    const attr = this.getOptionalErrorAttribute(response, name);\n    if (attr != null) {\n      return attr;\n    }\n    throw new Error(\"Unknown response schema: attribute \" + name + \" is missing\");\n  }\n\n  private getOptionalErrorAttribute(response: Document, name: string): string {\n    const error = response.querySelector(\"response > error\");\n    if (error == null) {\n      return null;\n    }\n    const attr = error.attributes.getNamedItem(name);\n    if (attr == null) {\n      return null;\n    }\n    return attr.value;\n  }\n\n  private getAllErrorAttributes(response: Document): Map<string, string> {\n    const error = response.querySelector(\"response > error\");\n    if (error == null) {\n      return null;\n    }\n    const map = new Map<string, string>();\n    for (const attr of Array.from(error.attributes)) {\n      map.set(attr.name, attr.value);\n    }\n    return map;\n  }\n\n  private extractSessionFromLoginResponse(\n    response: Document,\n    keyIterationCount: number,\n    clientInfo: ClientInfo,\n  ): Session {\n    const ok = response.querySelector(\"response > ok\");\n    if (ok == null) {\n      return null;\n    }\n    const sessionId = ok.attributes.getNamedItem(\"sessionid\");\n    if (sessionId == null) {\n      return null;\n    }\n    const token = ok.attributes.getNamedItem(\"token\");\n    if (token == null) {\n      return null;\n    }\n\n    const session = new Session();\n    session.id = sessionId.value;\n    session.keyIterationCount = keyIterationCount;\n    session.token = token.value;\n    session.platform = clientInfo.platform;\n    const privateKey = ok.attributes.getNamedItem(\"privatekeyenc\");\n    if (privateKey != null && privateKey.value != null && privateKey.value.trim() != \"\") {\n      session.encryptedPrivateKey = privateKey.value;\n    }\n\n    return session;\n  }\n\n  private async performSingleLoginRequest(\n    username: string,\n    password: string,\n    fragmentId: string,\n    keyIterationCount: number,\n    extraParameters: Map<string, any>,\n    clientInfo: ClientInfo,\n    rest: RestClient,\n  ) {\n    const hash = await this.cryptoUtils.deriveKeyHash(username, password, keyIterationCount);\n\n    const parameters = new Map<string, any>([\n      [\"method\", PlatformToUserAgent.get(clientInfo.platform)],\n      [\"xml\", \"2\"],\n      [\"username\", username],\n      [\"hash\", Utils.fromBufferToHex(hash.buffer)],\n      [\"iterations\", keyIterationCount],\n      [\"includeprivatekeyenc\", \"1\"],\n      [\"outofbandsupported\", \"1\"],\n      [\"uuid\", clientInfo.id],\n      // TODO: Test against the real server if it's ok to send this every time!\n      [\"trustlabel\", clientInfo.description],\n    ]);\n    if (fragmentId != null) {\n      parameters.set(\"alpfragmentid\", fragmentId);\n      parameters.set(\"calculatedfragmentid\", fragmentId);\n    }\n    for (const [key, value] of extraParameters) {\n      parameters.set(key, value);\n    }\n\n    const response = await rest.postForm(\"login.php\", parameters);\n    if (response.status == HttpStatusCode.Ok) {\n      const text = await response.text();\n      const domParser = new window.DOMParser();\n      return domParser.parseFromString(text, \"text/xml\");\n    }\n    this.makeError(response);\n  }\n\n  private makeError(response: Response) {\n    // TODO: error parsing\n    throw new Error(\n      \"HTTP request to \" + response.url + \" failed with status \" + response.status + \".\",\n    );\n  }\n\n  private makeLoginError(response: Document): string {\n    const error = response.querySelector(\"response > error\");\n    if (error == null) {\n      return \"Unknown response schema\";\n    }\n\n    const cause = error.attributes.getNamedItem(\"cause\");\n    const message = error.attributes.getNamedItem(\"message\");\n\n    if (cause != null) {\n      switch (cause.value) {\n        case \"unknownemail\":\n          return \"Invalid username\";\n        case \"password_invalid\":\n        case \"unknownpassword\":\n          return \"Invalid password\";\n        case \"googleauthfailed\":\n        case \"microsoftauthfailed\":\n        case \"otpfailed\":\n          return \"Second factor code is incorrect\";\n        case \"multifactorresponsefailed\":\n          return \"Out of band authentication failed\";\n        case \"unifiedloginresult\":\n          return \"unifiedloginresult\";\n        default:\n          return message?.value ?? cause.value;\n      }\n    }\n\n    // No cause, maybe at least a message\n    if (message != null) {\n      return message.value;\n    }\n\n    // Nothing we know, just the error element\n    return \"Unknown error\";\n  }\n}\n","import { CryptoFunctionService } from \"@bitwarden/common/platform/abstractions/crypto-function.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\n\nexport class CryptoUtils {\n  constructor(private cryptoFunctionService: CryptoFunctionService) {}\n\n  async deriveKey(username: string, password: string, iterationCount: number) {\n    if (iterationCount < 0) {\n      throw new Error(\"Iteration count should be positive\");\n    }\n    if (iterationCount == 1) {\n      return await this.cryptoFunctionService.hash(username + password, \"sha256\");\n    }\n    return await this.cryptoFunctionService.pbkdf2(password, username, \"sha256\", iterationCount);\n  }\n\n  async deriveKeyHash(username: string, password: string, iterationCount: number) {\n    const key = await this.deriveKey(username, password, iterationCount);\n    if (iterationCount == 1) {\n      return await this.cryptoFunctionService.hash(\n        Utils.fromBufferToHex(key.buffer) + password,\n        \"sha256\",\n      );\n    }\n    return await this.cryptoFunctionService.pbkdf2(key, password, \"sha256\", 1);\n  }\n\n  ExclusiveOr(arr1: Uint8Array, arr2: Uint8Array) {\n    if (arr1.length !== arr2.length) {\n      throw new Error(\"Arrays must be the same length.\");\n    }\n    const result = new Uint8Array(arr1.length);\n    for (let i = 0; i < arr1.length; i++) {\n      result[i] = arr1[i] ^ arr2[i];\n    }\n    return result;\n  }\n\n  async decryptAes256PlainWithDefault(\n    data: Uint8Array,\n    encryptionKey: Uint8Array,\n    defaultValue: string,\n  ) {\n    try {\n      return this.decryptAes256Plain(data, encryptionKey);\n    } catch {\n      return defaultValue;\n    }\n  }\n\n  async decryptAes256Base64WithDefault(\n    data: Uint8Array,\n    encryptionKey: Uint8Array,\n    defaultValue: string,\n  ) {\n    try {\n      return this.decryptAes256Base64(data, encryptionKey);\n    } catch {\n      return defaultValue;\n    }\n  }\n\n  async decryptAes256Plain(data: Uint8Array, encryptionKey: Uint8Array) {\n    if (data.length === 0) {\n      return \"\";\n    }\n    // Byte 33 == character '!'\n    if (data[0] === 33 && data.length % 16 === 1 && data.length > 32) {\n      return this.decryptAes256CbcPlain(data, encryptionKey);\n    }\n    return this.decryptAes256EcbPlain(data, encryptionKey);\n  }\n\n  async decryptAes256Base64(data: Uint8Array, encryptionKey: Uint8Array) {\n    if (data.length === 0) {\n      return \"\";\n    }\n    // Byte 33 == character '!'\n    if (data[0] === 33) {\n      return this.decryptAes256CbcBase64(data, encryptionKey);\n    }\n    return this.decryptAes256EcbBase64(data, encryptionKey);\n  }\n\n  async decryptAes256(\n    data: Uint8Array,\n    encryptionKey: Uint8Array,\n    mode: \"cbc\" | \"ecb\",\n    iv: Uint8Array = new Uint8Array(16),\n  ): Promise<string> {\n    if (data.length === 0) {\n      return \"\";\n    }\n    const plain = await this.cryptoFunctionService.aesDecrypt(data, iv, encryptionKey, mode);\n    return Utils.fromBufferToUtf8(plain);\n  }\n\n  private async decryptAes256EcbPlain(data: Uint8Array, encryptionKey: Uint8Array) {\n    return this.decryptAes256(data, encryptionKey, \"ecb\");\n  }\n\n  private async decryptAes256EcbBase64(data: Uint8Array, encryptionKey: Uint8Array) {\n    const d = Utils.fromB64ToArray(Utils.fromBufferToUtf8(data));\n    return this.decryptAes256(d, encryptionKey, \"ecb\");\n  }\n\n  private async decryptAes256CbcPlain(data: Uint8Array, encryptionKey: Uint8Array) {\n    const d = data.subarray(17);\n    const iv = data.subarray(1, 17);\n    return this.decryptAes256(d, encryptionKey, \"cbc\", iv);\n  }\n\n  private async decryptAes256CbcBase64(data: Uint8Array, encryptionKey: Uint8Array) {\n    const d = Utils.fromB64ToArray(Utils.fromBufferToUtf8(data.subarray(26)));\n    const iv = Utils.fromB64ToArray(Utils.fromBufferToUtf8(data.subarray(1, 25)));\n    return this.decryptAes256(d, encryptionKey, \"cbc\", iv);\n  }\n}\n","import { CryptoFunctionService } from \"@bitwarden/common/platform/abstractions/crypto-function.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\n\nimport { Account, Chunk, ParserOptions, SharedFolder } from \"../models\";\n\nimport { BinaryReader } from \"./binary-reader\";\nimport { CryptoUtils } from \"./crypto-utils\";\n\nconst AllowedSecureNoteTypes = new Set<string>([\n  \"Server\",\n  \"Email Account\",\n  \"Database\",\n  \"Instant Messenger\",\n]);\n\nexport class Parser {\n  constructor(\n    private cryptoFunctionService: CryptoFunctionService,\n    private cryptoUtils: CryptoUtils,\n  ) {}\n\n  /*\n  May return null when the chunk does not represent an account.\n  All secure notes are ACCTs but not all of them store account information.\n  \n  TODO: Add a test for the folder case!\n  TODO: Add a test case that covers secure note account!\n  */\n  async parseAcct(\n    chunk: Chunk,\n    encryptionKey: Uint8Array,\n    folder: SharedFolder,\n    options: ParserOptions,\n  ): Promise<Account> {\n    let id: string;\n    let step = 0;\n    try {\n      const placeholder = \"decryption failed\";\n      const reader = new BinaryReader(chunk.payload);\n\n      // Read all items\n      // 0: id\n      id = Utils.fromBufferToUtf8(this.readItem(reader));\n\n      // 1: name\n      step = 1;\n      const name = await this.cryptoUtils.decryptAes256PlainWithDefault(\n        this.readItem(reader),\n        encryptionKey,\n        placeholder,\n      );\n\n      // 2: group\n      step = 2;\n      const group = await this.cryptoUtils.decryptAes256PlainWithDefault(\n        this.readItem(reader),\n        encryptionKey,\n        placeholder,\n      );\n\n      // 3: url\n      step = 3;\n      let url = Utils.fromBufferToUtf8(\n        this.decodeHexLoose(Utils.fromBufferToUtf8(this.readItem(reader))),\n      );\n\n      // Ignore \"group\" accounts. They have no credentials.\n      if (url == \"http://group\") {\n        return null;\n      }\n\n      // 4: extra (notes)\n      step = 4;\n      const notes = await this.cryptoUtils.decryptAes256PlainWithDefault(\n        this.readItem(reader),\n        encryptionKey,\n        placeholder,\n      );\n\n      // 5: fav (is favorite)\n      step = 5;\n      const isFavorite = Utils.fromBufferToUtf8(this.readItem(reader)) === \"1\";\n\n      // 6: sharedfromaid (?)\n      this.skipItem(reader);\n\n      // 7: username\n      step = 7;\n      let username = await this.cryptoUtils.decryptAes256PlainWithDefault(\n        this.readItem(reader),\n        encryptionKey,\n        placeholder,\n      );\n\n      // 8: password\n      step = 8;\n      let password = await this.cryptoUtils.decryptAes256PlainWithDefault(\n        this.readItem(reader),\n        encryptionKey,\n        placeholder,\n      );\n\n      // 9: pwprotect (?)\n      this.skipItem(reader);\n\n      // 10: genpw (?)\n      this.skipItem(reader);\n\n      // 11: sn (is secure note)\n      step = 11;\n      const isSecureNote = Utils.fromBufferToUtf8(this.readItem(reader)) === \"1\";\n\n      // Parse secure note\n      if (options.parseSecureNotesToAccount && isSecureNote) {\n        let type = \"\";\n        // ParseSecureNoteServer\n        for (const i of notes.split(\"\\n\")) {\n          const keyValue = i.split(\":\", 2);\n          if (keyValue.length < 2) {\n            continue;\n          }\n          switch (keyValue[0]) {\n            case \"NoteType\":\n              type = keyValue[1];\n              break;\n            case \"Hostname\":\n              url = keyValue[1];\n              break;\n            case \"Username\":\n              username = keyValue[1];\n              break;\n            case \"Password\":\n              password = keyValue[1];\n              break;\n          }\n        }\n\n        // Only the some secure notes contain account-like information\n        if (!AllowedSecureNoteTypes.has(type)) {\n          return null;\n        }\n      }\n\n      // 12: last_touch_gmt (?)\n      this.skipItem(reader);\n\n      // 13: autologin (?)\n      this.skipItem(reader);\n\n      // 14: never_autofill (?)\n      this.skipItem(reader);\n\n      // 15: realm (?)\n      this.skipItem(reader);\n\n      // 16: id_again (?)\n      this.skipItem(reader);\n\n      // 17: custom_js (?)\n      this.skipItem(reader);\n\n      // 18: submit_id (?)\n      this.skipItem(reader);\n\n      // 19: captcha_id (?)\n      this.skipItem(reader);\n\n      // 20: urid (?)\n      this.skipItem(reader);\n\n      // 21: basic_auth (?)\n      this.skipItem(reader);\n\n      // 22: method (?)\n      this.skipItem(reader);\n\n      // 23: action (?)\n      this.skipItem(reader);\n\n      // 24: groupid (?)\n      this.skipItem(reader);\n\n      // 25: deleted (?)\n      this.skipItem(reader);\n\n      // 26: attachkey (?)\n      this.skipItem(reader);\n\n      // 27: attachpresent (?)\n      this.skipItem(reader);\n\n      // 28: individualshare (?)\n      this.skipItem(reader);\n\n      // 29: notetype (?)\n      this.skipItem(reader);\n\n      // 30: noalert (?)\n      this.skipItem(reader);\n\n      // 31: last_modified_gmt (?)\n      this.skipItem(reader);\n\n      // 32: hasbeenshared (?)\n      this.skipItem(reader);\n\n      // 33: last_pwchange_gmt (?)\n      this.skipItem(reader);\n\n      // 34: created_gmt (?)\n      this.skipItem(reader);\n\n      // 35: vulnerable (?)\n      this.skipItem(reader);\n\n      // 36: pwch (?)\n      this.skipItem(reader);\n\n      // 37: breached (?)\n      this.skipItem(reader);\n\n      // 38: template (?)\n      this.skipItem(reader);\n\n      // 39: totp (?)\n      step = 39;\n      const totp = await this.cryptoUtils.decryptAes256PlainWithDefault(\n        this.readItem(reader),\n        encryptionKey,\n        placeholder,\n      );\n\n      // 3 more left. Don't even bother skipping them.\n\n      // 40: trustedHostnames (?)\n      // 41: last_credential_monitoring_gmt (?)\n      // 42: last_credential_monitoring_stat (?)\n\n      // Adjust the path to include the group and the shared folder, if any.\n      step = 42;\n      const path = this.makeAccountPath(group, folder);\n\n      const account = new Account();\n      account.id = id;\n      account.name = name;\n      account.username = username;\n      account.password = password;\n      account.url = url;\n      account.path = path;\n      account.notes = notes;\n      account.totp = totp;\n      account.isFavorite = isFavorite;\n      account.isShared = folder != null;\n      return account;\n    } catch (err) {\n      throw new Error(\n        \"Error parsing accounts on item with ID:\" +\n          id +\n          \" step #\" +\n          step +\n          \" errorMessage: \" +\n          err.message,\n      );\n    }\n  }\n\n  async parseShar(\n    chunk: Chunk,\n    encryptionKey: Uint8Array,\n    rsaKey: Uint8Array,\n  ): Promise<SharedFolder> {\n    let id: string;\n    try {\n      const reader = new BinaryReader(chunk.payload);\n\n      // Id\n      id = Utils.fromBufferToUtf8(this.readItem(reader));\n\n      // Key\n      const folderKey = this.readItem(reader);\n      const rsaEncryptedFolderKey = Utils.fromHexToArray(Utils.fromBufferToUtf8(folderKey));\n      const decFolderKey = await this.cryptoFunctionService.rsaDecrypt(\n        rsaEncryptedFolderKey,\n        rsaKey,\n        \"sha1\",\n      );\n      const key = Utils.fromHexToArray(Utils.fromBufferToUtf8(decFolderKey));\n\n      // Name\n      const encryptedName = this.readItem(reader);\n      const name = await this.cryptoUtils.decryptAes256Base64(encryptedName, key);\n\n      const folder = new SharedFolder();\n      folder.id = id;\n      folder.name = name;\n      folder.encryptionKey = key;\n      return folder;\n    } catch (err) {\n      throw new Error(\n        \"Error parsing shared folder with ID:\" + id + \" errorMessage: \" + err.message,\n      );\n    }\n  }\n\n  async parseEncryptedPrivateKey(encryptedPrivateKey: string, encryptionKey: Uint8Array) {\n    const decrypted = await this.cryptoUtils.decryptAes256(\n      Utils.fromHexToArray(encryptedPrivateKey),\n      encryptionKey,\n      \"cbc\",\n      encryptionKey.subarray(0, 16),\n    );\n\n    const header = \"LastPassPrivateKey<\";\n    const footer = \">LastPassPrivateKey\";\n    if (!decrypted.startsWith(header) || !decrypted.endsWith(footer)) {\n      throw new Error(\"Failed to decrypt private key\");\n    }\n\n    const parsedKey = decrypted.substring(header.length, decrypted.length - footer.length);\n    const pkcs8 = Utils.fromHexToArray(parsedKey);\n    return pkcs8;\n  }\n\n  makeAccountPath(group: string, folder: SharedFolder): string {\n    const groupEmpty = group == null || group.trim() === \"\";\n    if (folder == null) {\n      return groupEmpty ? \"(none)\" : group;\n    }\n    return groupEmpty ? folder.name : folder.name + \"\\\\\" + group;\n  }\n\n  extractChunks(reader: BinaryReader): Chunk[] {\n    const chunks = new Array<Chunk>();\n    while (!reader.atEnd()) {\n      const chunk = this.readChunk(reader);\n      chunks.push(chunk);\n\n      // TODO: catch end of stream exception?\n      // In case the stream is truncated we just ignore the incomplete chunk.\n    }\n    return chunks;\n  }\n\n  private readChunk(reader: BinaryReader): Chunk {\n    /*\n    LastPass blob chunk is made up of 4-byte ID, big endian 4-byte size and payload of that size\n    Example:\n      0000: 'IDID'\n      0004: 4\n      0008: 0xDE 0xAD 0xBE 0xEF\n      000C: --- Next chunk ---\n    */\n    const chunk = new Chunk();\n    chunk.id = this.readId(reader);\n    chunk.payload = this.readPayload(reader, this.readSize(reader));\n    return chunk;\n  }\n\n  private readItem(reader: BinaryReader): Uint8Array {\n    /*\n    An item in an itemized chunk is made up of the big endian size and the payload of that size\n    Example:\n      0000: 4\n      0004: 0xDE 0xAD 0xBE 0xEF\n      0008: --- Next item ---\n    See readItem for item description.\n    */\n    return this.readPayload(reader, this.readSize(reader));\n  }\n\n  private skipItem(reader: BinaryReader): void {\n    // See readItem for item description.\n    reader.seekFromCurrentPosition(this.readSize(reader));\n  }\n\n  private readId(reader: BinaryReader): string {\n    return Utils.fromBufferToUtf8(reader.readBytes(4));\n  }\n\n  private readSize(reader: BinaryReader): number {\n    return reader.readUInt32BigEndian();\n  }\n\n  private readPayload(reader: BinaryReader, size: number): Uint8Array {\n    return reader.readBytes(size);\n  }\n\n  private decodeHexLoose(s: string): Uint8Array {\n    // This is a forgiving version that pads the input with a '0' when the length is odd\n    return Utils.fromHexToArray(s.length % 2 == 0 ? s : \"0\" + s);\n  }\n}\n","import * as papa from \"papaparse\";\n\nimport { decodeJwtTokenToJson } from \"@bitwarden/auth/common\";\nimport { HttpStatusCode } from \"@bitwarden/common/enums\";\nimport { CryptoFunctionService } from \"@bitwarden/common/platform/abstractions/crypto-function.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\n\nimport { IdpProvider } from \"./enums\";\nimport {\n  Account,\n  ClientInfo,\n  ExportedAccount,\n  FederatedUserContext,\n  ParserOptions,\n  UserTypeContext,\n} from \"./models\";\nimport { Client, CryptoUtils, Parser, RestClient } from \"./services\";\nimport { Ui } from \"./ui\";\n\nexport class Vault {\n  accounts: Account[];\n  userType: UserTypeContext;\n\n  private client: Client;\n  private cryptoUtils: CryptoUtils;\n\n  constructor(private cryptoFunctionService: CryptoFunctionService) {\n    this.cryptoUtils = new CryptoUtils(cryptoFunctionService);\n    const parser = new Parser(cryptoFunctionService, this.cryptoUtils);\n    this.client = new Client(parser, this.cryptoUtils);\n  }\n\n  async open(\n    username: string,\n    password: string,\n    clientInfo: ClientInfo,\n    ui: Ui,\n    parserOptions: ParserOptions = ParserOptions.default,\n  ): Promise<void> {\n    this.accounts = await this.client.openVault(\n      username,\n      password,\n      null,\n      clientInfo,\n      ui,\n      parserOptions,\n    );\n  }\n\n  async openFederated(\n    federatedUser: FederatedUserContext,\n    clientInfo: ClientInfo,\n    ui: Ui,\n    parserOptions: ParserOptions = ParserOptions.default,\n  ): Promise<void> {\n    if (federatedUser == null) {\n      throw new Error(\"Federated user context is not set.\");\n    }\n    const k1 = await this.getK1(federatedUser);\n    const [k2, fragmentId] = await this.getK2FragmentId(federatedUser);\n    const hiddenPasswordArr = await this.cryptoFunctionService.hash(\n      this.cryptoUtils.ExclusiveOr(k1, k2),\n      \"sha256\",\n    );\n    const hiddenPassword = Utils.fromBufferToB64(hiddenPasswordArr);\n    this.accounts = await this.client.openVault(\n      federatedUser.username,\n      hiddenPassword,\n      fragmentId,\n      clientInfo,\n      ui,\n      parserOptions,\n    );\n  }\n\n  async setUserTypeContext(username: string) {\n    const lowercaseUsername = username.toLowerCase();\n    const rest = new RestClient();\n    rest.baseUrl = \"https://lastpass.com\";\n    const endpoint = \"lmiapi/login/type?username=\" + encodeURIComponent(lowercaseUsername);\n    const response = await rest.get(endpoint);\n    if (response.status === HttpStatusCode.Ok) {\n      const json = await response.json();\n      this.userType = new UserTypeContext();\n      this.userType.companyId = json.CompanyId;\n      this.userType.identityProviderGUID = json.IdentityProviderGUID;\n      this.userType.identityProviderURL = json.IdentityProviderURL;\n      this.userType.isPasswordlessEnabled = json.IsPasswordlessEnabled;\n      this.userType.openIDConnectAuthority = json.OpenIDConnectAuthority;\n      this.userType.openIDConnectClientId = json.OpenIDConnectClientId;\n      this.userType.pkceEnabled = json.PkceEnabled;\n      this.userType.provider = json.Provider;\n      this.userType.type = json.type;\n\n      if (this.userType.provider === IdpProvider.Azure) {\n        // Sometimes customers have malformed OIDC authority URLs. Try to fix them.\n        const appQueryIndex = this.userType.openIDConnectAuthority.indexOf(\"?app\");\n        if (appQueryIndex > -1) {\n          this.userType.openIDConnectAuthority = this.userType.openIDConnectAuthority.substring(\n            0,\n            appQueryIndex,\n          );\n        }\n      }\n\n      return;\n    }\n    throw new Error(\"Cannot determine LastPass user type.\");\n  }\n\n  accountsToExportedCsvString(skipShared = false): string {\n    if (this.accounts == null) {\n      throw new Error(\"Vault has not opened any accounts.\");\n    }\n\n    const exportedAccounts = this.accounts\n      .filter((a) => !a.isShared || (a.isShared && !skipShared))\n      .map((a) => new ExportedAccount(a));\n\n    if (exportedAccounts.length === 0) {\n      throw new Error(\"No accounts to transform\");\n    }\n    return papa.unparse(exportedAccounts);\n  }\n\n  private async getK1(federatedUser: FederatedUserContext): Promise<Uint8Array> {\n    if (this.userType == null) {\n      throw new Error(\"User type is not set.\");\n    }\n\n    if (!this.userType.isFederated()) {\n      throw new Error(\"Cannot get k1 for LastPass user that is not federated.\");\n    }\n\n    if (federatedUser == null) {\n      throw new Error(\"Federated user is not set.\");\n    }\n\n    let k1: Uint8Array = null;\n    if (federatedUser.idpUserInfo?.LastPassK1 != null) {\n      return Utils.fromByteStringToArray(federatedUser.idpUserInfo.LastPassK1);\n    } else if (this.userType.provider === IdpProvider.Azure) {\n      k1 = await this.getK1Azure(federatedUser);\n    } else if (this.userType.provider === IdpProvider.Google) {\n      k1 = await this.getK1Google(federatedUser);\n    } else {\n      const b64Encoded = this.userType.provider === IdpProvider.PingOne;\n      k1 = await this.getK1FromAccessToken(federatedUser, b64Encoded);\n    }\n\n    if (k1 != null) {\n      return k1;\n    }\n\n    throw new Error(\"Cannot get k1.\");\n  }\n\n  private async getK1Azure(federatedUser: FederatedUserContext) {\n    // Query the Graph API for the k1 field\n    const rest = new RestClient();\n    rest.baseUrl = \"https://graph.microsoft.com\";\n    const response = await rest.get(\n      \"v1.0/me?$select=id,displayName,mail&$expand=extensions\",\n      new Map([[\"Authorization\", \"Bearer \" + federatedUser.accessToken]]),\n    );\n    if (response.status === HttpStatusCode.Ok) {\n      const json = await response.json();\n      if (json?.extensions != null && json.extensions.length > 0) {\n        const k1 = json.extensions[0].LastPassK1 as string;\n        if (k1 != null) {\n          return Utils.fromB64ToArray(k1);\n        }\n      }\n    }\n    return null;\n  }\n\n  private async getK1Google(federatedUser: FederatedUserContext) {\n    // Query Google Drive for the k1.lp file\n    const accessTokenAuthHeader = new Map([\n      [\"Authorization\", \"Bearer \" + federatedUser.accessToken],\n    ]);\n    const rest = new RestClient();\n    rest.baseUrl = \"https://content.googleapis.com\";\n    const response = await rest.get(\n      \"drive/v3/files?pageSize=1\" +\n        \"&q=name%20%3D%20%27k1.lp%27\" +\n        \"&spaces=appDataFolder\" +\n        \"&fields=nextPageToken%2C%20files(id%2C%20name)\",\n      accessTokenAuthHeader,\n    );\n    if (response.status === HttpStatusCode.Ok) {\n      const json = await response.json();\n      const files = json?.files as any[];\n      if (files != null && files.length > 0 && files[0].id != null && files[0].name === \"k1.lp\") {\n        // Open the k1.lp file\n        rest.baseUrl = \"https://www.googleapis.com\";\n        const response = await rest.get(\n          \"drive/v3/files/\" + files[0].id + \"?alt=media\",\n          accessTokenAuthHeader,\n        );\n        if (response.status === HttpStatusCode.Ok) {\n          const k1 = await response.text();\n          return Utils.fromB64ToArray(k1);\n        }\n      }\n    }\n    return null;\n  }\n\n  private async getK1FromAccessToken(federatedUser: FederatedUserContext, b64: boolean) {\n    const decodedAccessToken = decodeJwtTokenToJson(federatedUser.accessToken);\n    const k1 = decodedAccessToken?.LastPassK1 as string;\n    if (k1 != null) {\n      return b64 ? Utils.fromB64ToArray(k1) : Utils.fromByteStringToArray(k1);\n    }\n    return null;\n  }\n\n  private async getK2FragmentId(\n    federatedUser: FederatedUserContext,\n  ): Promise<[Uint8Array, string]> {\n    if (this.userType == null) {\n      throw new Error(\"User type is not set.\");\n    }\n\n    if (!this.userType.isFederated()) {\n      throw new Error(\"Cannot get k2 for LastPass user that is not federated.\");\n    }\n\n    const rest = new RestClient();\n    rest.baseUrl = this.userType.identityProviderURL;\n    const response = await rest.postJson(\"federatedlogin/api/v1/getkey\", {\n      company_id: this.userType.companyId,\n      id_token: federatedUser.idToken,\n    });\n    if (response.status === HttpStatusCode.Ok) {\n      const json = await response.json();\n      const k2 = json?.k2 as string;\n      const fragmentId = json?.fragment_id as string;\n      if (k2 != null && fragmentId != null) {\n        return [Utils.fromB64ToArray(k2), fragmentId];\n      }\n    }\n    throw new Error(\"Cannot get k2 and/or fragment ID.\");\n  }\n}\n","import { DialogRef } from \"@angular/cdk/dialog\";\nimport { CommonModule } from \"@angular/common\";\nimport { Component } from \"@angular/core\";\nimport { FormControl, FormGroup, ReactiveFormsModule, Validators } from \"@angular/forms\";\nimport { firstValueFrom } from \"rxjs\";\n\nimport { JslibModule } from \"@bitwarden/angular/jslib.module\";\nimport {\n  AsyncActionsModule,\n  ButtonModule,\n  DialogModule,\n  DialogService,\n  FormFieldModule,\n  IconButtonModule,\n  TypographyModule,\n} from \"@bitwarden/components\";\n\n@Component({\n  templateUrl: \"lastpass-password-prompt.component.html\",\n  standalone: true,\n  imports: [\n    CommonModule,\n    JslibModule,\n    ReactiveFormsModule,\n    DialogModule,\n    FormFieldModule,\n    AsyncActionsModule,\n    ButtonModule,\n    IconButtonModule,\n    TypographyModule,\n  ],\n})\nexport class LastPassPasswordPromptComponent {\n  protected formGroup = new FormGroup({\n    password: new FormControl(\"\", {\n      validators: Validators.required,\n      updateOn: \"submit\",\n    }),\n  });\n\n  constructor(public dialogRef: DialogRef) {}\n\n  submit = () => {\n    this.formGroup.markAsTouched();\n    if (!this.formGroup.valid) {\n      return;\n    }\n    this.dialogRef.close(this.formGroup.controls.password.value);\n  };\n\n  static open(dialogService: DialogService) {\n    const dialogRef = dialogService.open<string>(LastPassPasswordPromptComponent);\n    return firstValueFrom(dialogRef.closed);\n  }\n}\n","<form [formGroup]=\"formGroup\" [bitSubmit]=\"submit\">\n  <bit-dialog>\n    <span bitDialogTitle>\n      {{ \"lastPassAuthRequired\" | i18n }}\n    </span>\n\n    <div bitDialogContent>\n      <bit-form-field class=\"!tw-mb-0\">\n        <bit-label>{{ \"lastPassMasterPassword\" | i18n }}</bit-label>\n        <input bitInput type=\"password\" formControlName=\"password\" appAutofocus appInputVerbatim />\n        <button type=\"button\" bitSuffix bitIconButton bitPasswordInputToggle></button>\n        <bit-hint>{{ \"confirmIdentity\" | i18n }}</bit-hint>\n      </bit-form-field>\n    </div>\n\n    <ng-container bitDialogFooter>\n      <button bitButton buttonType=\"primary\" type=\"submit\" bitFormButton>\n        <span>{{ \"submit\" | i18n }}</span>\n      </button>\n      <button bitButton bitDialogClose buttonType=\"secondary\" type=\"button\" bitFormButton>\n        <span>{{ \"cancel\" | i18n }}</span>\n      </button>\n    </ng-container>\n  </bit-dialog>\n</form>\n","import { DIALOG_DATA, DialogRef } from \"@angular/cdk/dialog\";\nimport { CommonModule } from \"@angular/common\";\nimport { Component, Inject } from \"@angular/core\";\nimport { FormControl, FormGroup, ReactiveFormsModule, Validators } from \"@angular/forms\";\n\nimport { JslibModule } from \"@bitwarden/angular/jslib.module\";\nimport {\n  AsyncActionsModule,\n  ButtonModule,\n  DialogModule,\n  DialogService,\n  FormFieldModule,\n  IconButtonModule,\n  TypographyModule,\n} from \"@bitwarden/components\";\n\nexport type LastPassMultifactorPromptVariant = \"otp\" | \"oob\" | \"yubikey\";\n\ntype LastPassMultifactorPromptData = {\n  variant: LastPassMultifactorPromptVariant;\n};\n\n@Component({\n  templateUrl: \"lastpass-multifactor-prompt.component.html\",\n  standalone: true,\n  imports: [\n    CommonModule,\n    JslibModule,\n    ReactiveFormsModule,\n    DialogModule,\n    FormFieldModule,\n    AsyncActionsModule,\n    ButtonModule,\n    IconButtonModule,\n    TypographyModule,\n  ],\n})\nexport class LastPassMultifactorPromptComponent {\n  private variant = this.data.variant;\n\n  protected get descriptionI18nKey(): string {\n    switch (this.variant) {\n      case \"oob\":\n        return \"lastPassOOBDesc\";\n      case \"yubikey\":\n        return \"lastPassYubikeyDesc\";\n      case \"otp\":\n      default:\n        return \"lastPassMFADesc\";\n    }\n  }\n\n  protected formGroup = new FormGroup({\n    passcode: new FormControl(\"\", {\n      validators: Validators.required,\n      updateOn: \"submit\",\n    }),\n  });\n\n  constructor(\n    public dialogRef: DialogRef,\n    @Inject(DIALOG_DATA) protected data: LastPassMultifactorPromptData,\n  ) {}\n\n  submit = () => {\n    this.formGroup.markAsTouched();\n    if (!this.formGroup.valid) {\n      return;\n    }\n    this.dialogRef.close(this.formGroup.value.passcode);\n  };\n\n  static open(dialogService: DialogService, data: LastPassMultifactorPromptData) {\n    return dialogService.open<string>(LastPassMultifactorPromptComponent, { data });\n  }\n}\n","<form [formGroup]=\"formGroup\" [bitSubmit]=\"submit\">\n  <bit-dialog>\n    <span bitDialogTitle>\n      {{ \"lastPassMFARequired\" | i18n }}\n    </span>\n\n    <div bitDialogContent>\n      <p>{{ descriptionI18nKey | i18n }}</p>\n      <bit-form-field class=\"!tw-mb-0\">\n        <bit-label>{{ \"passcode\" | i18n }}</bit-label>\n        <input bitInput type=\"text\" formControlName=\"passcode\" appAutofocus appInputVerbatim />\n        <bit-hint>{{ \"confirmIdentity\" | i18n }}</bit-hint>\n      </bit-form-field>\n    </div>\n\n    <ng-container bitDialogFooter>\n      <button bitButton buttonType=\"primary\" type=\"submit\" bitFormButton>\n        <span>{{ \"continue\" | i18n }}</span>\n      </button>\n      <button bitButton bitDialogClose=\"cancel\" buttonType=\"secondary\" type=\"button\" bitFormButton>\n        <span>{{ \"cancel\" | i18n }}</span>\n      </button>\n    </ng-container>\n  </bit-dialog>\n</form>\n","import { DialogRef } from \"@angular/cdk/dialog\";\nimport { Injectable } from \"@angular/core\";\nimport { firstValueFrom } from \"rxjs\";\n\nimport { DialogService } from \"@bitwarden/components\";\n\nimport { OtpResult, OobResult } from \"../../importers/lastpass/access/models\";\nimport { Ui } from \"../../importers/lastpass/access/ui\";\n\nimport { LastPassMultifactorPromptComponent } from \"./dialog\";\nimport { LastPassMultifactorPromptVariant } from \"./dialog/lastpass-multifactor-prompt.component\";\n\ntype OtpDialogVariant = Extract<LastPassMultifactorPromptVariant, \"otp\" | \"yubikey\">;\ntype OobDialogVariant = Extract<LastPassMultifactorPromptVariant, \"oob\">;\n\n@Injectable({\n  providedIn: \"root\",\n})\nexport class LastPassDirectImportUIService implements Ui {\n  private mfaDialogRef: DialogRef<string>;\n\n  constructor(private dialogService: DialogService) {}\n\n  private async getOTPResult(variant: OtpDialogVariant) {\n    const passcode = await this.openMFADialog(variant);\n    return new OtpResult(passcode, false);\n  }\n\n  private async getOOBResult(variant: OobDialogVariant) {\n    const passcode = await this.openMFADialog(variant);\n    return new OobResult(false, passcode, false);\n  }\n\n  private openMFADialog(variant: LastPassMultifactorPromptVariant) {\n    this.mfaDialogRef = LastPassMultifactorPromptComponent.open(this.dialogService, {\n      variant,\n    });\n    return firstValueFrom(this.mfaDialogRef.closed);\n  }\n\n  closeMFADialog() {\n    this.mfaDialogRef?.close();\n  }\n\n  async provideGoogleAuthPasscode() {\n    return this.getOTPResult(\"otp\");\n  }\n\n  async provideMicrosoftAuthPasscode() {\n    return this.getOTPResult(\"otp\");\n  }\n\n  async provideYubikeyPasscode() {\n    return this.getOTPResult(\"yubikey\");\n  }\n\n  async approveLastPassAuth() {\n    return this.getOOBResult(\"oob\");\n  }\n  async approveDuo() {\n    return this.getOOBResult(\"oob\");\n  }\n  async approveSalesforceAuth() {\n    return this.getOOBResult(\"oob\");\n  }\n}\n","import { Injectable, NgZone } from \"@angular/core\";\nimport { OidcClient } from \"oidc-client-ts\";\nimport { Subject, firstValueFrom } from \"rxjs\";\n\nimport { ClientType } from \"@bitwarden/common/enums\";\nimport { AppIdService } from \"@bitwarden/common/platform/abstractions/app-id.service\";\nimport { BroadcasterService } from \"@bitwarden/common/platform/abstractions/broadcaster.service\";\nimport { CryptoFunctionService } from \"@bitwarden/common/platform/abstractions/crypto-function.service\";\nimport { EnvironmentService } from \"@bitwarden/common/platform/abstractions/environment.service\";\nimport { I18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { PasswordGenerationServiceAbstraction } from \"@bitwarden/common/tools/generator/password\";\n\nimport { DialogService } from \"../../../../components/src/dialog\";\nimport { ClientInfo, Vault } from \"../../importers/lastpass/access\";\nimport { FederatedUserContext } from \"../../importers/lastpass/access/models\";\n\nimport { LastPassPasswordPromptComponent } from \"./dialog/lastpass-password-prompt.component\";\nimport { LastPassDirectImportUIService } from \"./lastpass-direct-import-ui.service\";\n\n@Injectable({\n  providedIn: \"root\",\n})\nexport class LastPassDirectImportService {\n  private vault: Vault;\n\n  private oidcClient: OidcClient;\n\n  private _ssoImportCallback$ = new Subject<{ oidcCode: string; oidcState: string }>();\n  ssoImportCallback$ = this._ssoImportCallback$.asObservable();\n\n  constructor(\n    private cryptoFunctionService: CryptoFunctionService,\n    private environmentService: EnvironmentService,\n    private appIdService: AppIdService,\n    private lastPassDirectImportUIService: LastPassDirectImportUIService,\n    private platformUtilsService: PlatformUtilsService,\n    private passwordGenerationService: PasswordGenerationServiceAbstraction,\n    private broadcasterService: BroadcasterService,\n    private ngZone: NgZone,\n    private dialogService: DialogService,\n    private i18nService: I18nService,\n  ) {\n    this.vault = new Vault(this.cryptoFunctionService);\n\n    /** TODO: remove this in favor of dedicated service */\n    this.broadcasterService.subscribe(\"LastPassDirectImportService\", (message: any) => {\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.ngZone.run(async () => {\n        switch (message.command) {\n          case \"importCallbackLastPass\":\n            this._ssoImportCallback$.next({ oidcCode: message.code, oidcState: message.state });\n            break;\n          default:\n            break;\n        }\n      });\n    });\n  }\n\n  /**\n   * Import a LastPass account by email\n   * @param email\n   * @param includeSharedFolders\n   * @returns The CSV export data of the account\n   */\n  async handleImport(email: string, includeSharedFolders: boolean): Promise<string> {\n    await this.verifyLastPassAccountExists(email);\n\n    if (this.isAccountFederated) {\n      const oidc = await this.handleFederatedLogin(email);\n      const csvData = await this.handleFederatedImport(\n        oidc.oidcCode,\n        oidc.oidcState,\n        includeSharedFolders,\n      );\n      return csvData;\n    }\n    const password = await LastPassPasswordPromptComponent.open(this.dialogService);\n    const csvData = await this.handleStandardImport(email, password, includeSharedFolders);\n\n    return csvData;\n  }\n\n  private get isAccountFederated(): boolean {\n    return this.vault.userType.isFederated();\n  }\n\n  private async verifyLastPassAccountExists(email: string) {\n    await this.vault.setUserTypeContext(email);\n  }\n\n  private async handleFederatedLogin(email: string) {\n    const ssoCallbackPromise = firstValueFrom(this.ssoImportCallback$);\n    const request = await this.createOidcSigninRequest(email);\n    this.platformUtilsService.launchUri(request.url);\n\n    const cancelDialogRef = this.dialogService.openSimpleDialogRef({\n      title: this.i18nService.t(\"awaitingSSO\"),\n      content: this.i18nService.t(\"awaitingSSODesc\"),\n      type: \"warning\",\n      icon: \"bwi-key\",\n      acceptButtonText: this.i18nService.t(\"cancel\"),\n      cancelButtonText: null,\n    });\n    const cancelled = firstValueFrom(cancelDialogRef.closed).then((_didCancel) => {\n      throw Error(\"SSO auth cancelled\");\n    });\n\n    return Promise.race<{\n      oidcCode: string;\n      oidcState: string;\n    }>([cancelled, ssoCallbackPromise]).finally(() => {\n      cancelDialogRef.close();\n    });\n  }\n\n  private async createOidcSigninRequest(email: string) {\n    this.oidcClient = new OidcClient({\n      authority: this.vault.userType.openIDConnectAuthorityBase,\n      client_id: this.vault.userType.openIDConnectClientId,\n      redirect_uri: await this.getOidcRedirectUrl(),\n      response_type: \"code\",\n      scope: this.vault.userType.oidcScope,\n      response_mode: \"query\",\n      loadUserInfo: true,\n    });\n\n    return await this.oidcClient.createSigninRequest({\n      state: {\n        email,\n      },\n      nonce: await this.passwordGenerationService.generatePassword({\n        length: 20,\n        uppercase: true,\n        lowercase: true,\n        number: true,\n      }),\n    });\n  }\n\n  private getOidcRedirectUrlWithParams(oidcCode: string, oidcState: string) {\n    const redirectUri = this.oidcClient.settings.redirect_uri;\n    const params = \"code=\" + oidcCode + \"&state=\" + oidcState;\n    if (redirectUri.indexOf(\"bitwarden://\") === 0) {\n      return redirectUri + \"/?\" + params;\n    }\n\n    return redirectUri + \"&\" + params;\n  }\n\n  private async getOidcRedirectUrl() {\n    const clientType = this.platformUtilsService.getClientType();\n    if (clientType === ClientType.Desktop) {\n      return \"bitwarden://import-callback-lp\";\n    }\n    const env = await firstValueFrom(this.environmentService.environment$);\n    const webUrl = env.getWebVaultUrl();\n    return webUrl + \"/sso-connector.html?lp=1\";\n  }\n\n  private async handleStandardImport(\n    email: string,\n    password: string,\n    includeSharedFolders: boolean,\n  ): Promise<string> {\n    const clientInfo = await this.createClientInfo(email);\n    await this.vault.open(email, password, clientInfo, this.lastPassDirectImportUIService, {\n      parseSecureNotesToAccount: false,\n    });\n\n    return this.vault.accountsToExportedCsvString(!includeSharedFolders);\n  }\n\n  private async handleFederatedImport(\n    oidcCode: string,\n    oidcState: string,\n    includeSharedFolders: boolean,\n  ): Promise<string> {\n    const response = await this.oidcClient.processSigninResponse(\n      this.getOidcRedirectUrlWithParams(oidcCode, oidcState),\n    );\n    const userState = response.userState as any;\n\n    const federatedUser = new FederatedUserContext();\n    federatedUser.idToken = response.id_token;\n    federatedUser.accessToken = response.access_token;\n    federatedUser.idpUserInfo = response.profile;\n    federatedUser.username = userState.email;\n\n    const clientInfo = await this.createClientInfo(federatedUser.username);\n    await this.vault.openFederated(federatedUser, clientInfo, this.lastPassDirectImportUIService, {\n      parseSecureNotesToAccount: false,\n    });\n\n    return this.vault.accountsToExportedCsvString(!includeSharedFolders);\n  }\n\n  private async createClientInfo(email: string): Promise<ClientInfo> {\n    const appId = await this.appIdService.getAppId();\n    const id = \"lastpass\" + appId + email;\n    const idHash = await this.cryptoFunctionService.hash(id, \"sha256\");\n    return ClientInfo.createClientInfo(Utils.fromBufferToHex(idHash));\n  }\n}\n","import { CommonModule } from \"@angular/common\";\nimport { Component, EventEmitter, OnDestroy, OnInit, Output } from \"@angular/core\";\nimport {\n  AsyncValidatorFn,\n  ControlContainer,\n  FormBuilder,\n  FormGroup,\n  ReactiveFormsModule,\n  Validators,\n} from \"@angular/forms\";\nimport { map } from \"rxjs\";\n\nimport { JslibModule } from \"@bitwarden/angular/jslib.module\";\nimport { I18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport {\n  CalloutModule,\n  CheckboxModule,\n  FormFieldModule,\n  IconButtonModule,\n  TypographyModule,\n} from \"@bitwarden/components\";\n\nimport { LastPassDirectImportService } from \"./lastpass-direct-import.service\";\n\n@Component({\n  selector: \"import-lastpass\",\n  templateUrl: \"import-lastpass.component.html\",\n  standalone: true,\n  imports: [\n    CommonModule,\n    JslibModule,\n    CalloutModule,\n    TypographyModule,\n    FormFieldModule,\n    ReactiveFormsModule,\n    IconButtonModule,\n    CheckboxModule,\n  ],\n})\nexport class ImportLastPassComponent implements OnInit, OnDestroy {\n  private _parentFormGroup: FormGroup;\n  protected formGroup = this.formBuilder.group({\n    email: [\n      \"\",\n      {\n        validators: [Validators.required, Validators.email],\n        asyncValidators: [this.validateAndEmitData()],\n        updateOn: \"submit\",\n      },\n    ],\n    includeSharedFolders: [false],\n  });\n  protected emailHint$ = this.formGroup.controls.email.statusChanges.pipe(\n    map((status) => {\n      if (status === \"PENDING\") {\n        return this.i18nService.t(\"importingYourAccount\");\n      }\n    }),\n  );\n\n  @Output() csvDataLoaded = new EventEmitter<string>();\n\n  constructor(\n    private formBuilder: FormBuilder,\n    private controlContainer: ControlContainer,\n    private logService: LogService,\n    private lastPassDirectImportService: LastPassDirectImportService,\n    private i18nService: I18nService,\n  ) {}\n\n  ngOnInit(): void {\n    this._parentFormGroup = this.controlContainer.control as FormGroup;\n    this._parentFormGroup.addControl(\"lastpassOptions\", this.formGroup);\n  }\n\n  ngOnDestroy(): void {\n    this._parentFormGroup.removeControl(\"lastpassOptions\");\n  }\n\n  /**\n   * Attempts to login to the provided LastPass email and retrieve account contents.\n   * Will return a validation error if unable to login or fetch.\n   * Emits account contents to `csvDataLoaded`\n   */\n  validateAndEmitData(): AsyncValidatorFn {\n    return async () => {\n      try {\n        const csvData = await this.lastPassDirectImportService.handleImport(\n          this.formGroup.controls.email.value,\n          this.formGroup.controls.includeSharedFolders.value,\n        );\n        this.csvDataLoaded.emit(csvData);\n        return null;\n      } catch (error) {\n        this.logService.error(`LP importer error: ${error}`);\n        return {\n          errors: {\n            message: this.i18nService.t(this.getValidationErrorI18nKey(error)),\n          },\n        };\n      }\n    };\n  }\n\n  private getValidationErrorI18nKey(error: any): string {\n    const message = typeof error === \"string\" ? error : error?.message;\n    switch (message) {\n      case \"SSO auth cancelled\":\n      case \"Second factor step is canceled by the user\":\n      case \"Out of band step is canceled by the user\":\n        return \"multifactorAuthenticationCancelled\";\n      case \"No accounts to transform\":\n      case \"Vault has not opened any accounts.\":\n        return \"noLastPassDataFound\";\n      case \"Invalid username\":\n      case \"Invalid password\":\n        return \"incorrectUsernameOrPassword\";\n      case \"Second factor code is incorrect\":\n      case \"Out of band authentication failed\":\n        return \"multifactorAuthenticationFailed\";\n      case \"unifiedloginresult\":\n        return \"lastPassTryAgainCheckEmail\";\n      default:\n        return \"errorOccurred\";\n    }\n  }\n}\n","<div [formGroup]=\"formGroup\">\n  <bit-form-field>\n    <bit-label>{{ \"lastPassEmail\" | i18n }}</bit-label>\n    <input bitInput type=\"text\" formControlName=\"email\" />\n    <bit-hint>{{ emailHint$ | async }}</bit-hint>\n  </bit-form-field>\n  <bit-form-control>\n    <input\n      bitCheckbox\n      type=\"checkbox\"\n      formControlName=\"includeSharedFolders\"\n      id=\"import-lastpass_input_includeSharedFolders\"\n    />\n    <bit-label>{{ \"includeSharedFolders\" | i18n }}</bit-label>\n  </bit-form-control>\n</div>\n","<bit-callout type=\"info\" *ngIf=\"importBlockedByPolicy\">\n  {{ \"personalOwnershipPolicyInEffectImports\" | i18n }}\n</bit-callout>\n<form [formGroup]=\"formGroup\" [bitSubmit]=\"submit\" id=\"import_form_importForm\">\n  <bit-form-field [hidden]=\"isFromAC\">\n    <bit-label\n      >{{ \"importDestination\" | i18n }}\n      <a\n        target=\"_blank\"\n        rel=\"noreferrer\"\n        appA11yTitle=\"{{ 'learnAboutImportOptions' | i18n }}\"\n        href=\"https://bitwarden.com/help/import-data/\"\n      >\n        <i class=\"bwi bwi-question-circle\" aria-hidden=\"true\"></i>\n      </a>\n    </bit-label>\n    <bit-select formControlName=\"vaultSelector\">\n      <bit-option\n        *ngIf=\"!importBlockedByPolicy\"\n        [label]=\"'myVault' | i18n\"\n        value=\"myVault\"\n        icon=\"bwi-user\"\n      />\n      <bit-option\n        *ngFor=\"let o of organizations$ | async\"\n        [value]=\"o.id\"\n        [label]=\"o.name\"\n        icon=\"bwi-business\"\n      />\n    </bit-select>\n  </bit-form-field>\n\n  <bit-form-field>\n    <bit-label>{{ organizationId ? (\"collection\" | i18n) : (\"folder\" | i18n) }}</bit-label>\n    <bit-select formControlName=\"targetSelector\">\n      <ng-container *ngIf=\"!organizationId\">\n        <bit-option [value]=\"null\" label=\"-- {{ 'selectImportFolder' | i18n }} --\" />\n        <bit-option\n          *ngFor=\"let f of folders$ | async\"\n          [value]=\"f\"\n          [label]=\"f.name\"\n          icon=\"bwi-folder\"\n        />\n      </ng-container>\n      <ng-container *ngIf=\"organizationId\">\n        <bit-option [value]=\"null\" label=\"-- {{ 'selectImportCollection' | i18n }} --\" />\n        <bit-option\n          *ngFor=\"let c of collections$ | async\"\n          [value]=\"c\"\n          [label]=\"c.name\"\n          icon=\"bwi-collection\"\n        />\n      </ng-container>\n    </bit-select>\n    <bit-hint>{{\n      \"importTargetHint\"\n        | i18n: (organizationId ? (\"collection\" | i18n | lowercase) : (\"folder\" | i18n | lowercase))\n    }}</bit-hint>\n  </bit-form-field>\n\n  <bit-form-field class=\"tw-w-1/2\">\n    <bit-label>{{ \"fileFormat\" | i18n }}</bit-label>\n    <bit-select formControlName=\"format\">\n      <bit-option value=\"\" label=\"-- {{ 'select' | i18n }} --\" />\n      <bit-option\n        class=\"tw-font-bold tw-text-muted tw-text-xs\"\n        value=\"-\"\n        label=\"{{ 'commonImportFormats' | i18n }}\"\n        disabled\n      />\n      <bit-option *ngFor=\"let o of featuredImportOptions\" [value]=\"o.id\" [label]=\"o.name\" />\n      <ng-container *ngIf=\"importOptions && importOptions.length\">\n        <bit-option value=\"-\" label=\"--------------------------------------\" disabled />\n        <bit-option *ngFor=\"let o of importOptions\" [value]=\"o.id\" [label]=\"o.name\" />\n      </ng-container>\n    </bit-select>\n  </bit-form-field>\n  <bit-callout type=\"info\" title=\"{{ getFormatInstructionTitle() }}\" *ngIf=\"format\">\n    <ng-container *ngIf=\"format === 'bitwardencsv' || format === 'bitwardenjson'\">\n      See detailed instructions on our help site at\n      <a target=\"_blank\" rel=\"noreferrer\" href=\"https://bitwarden.com/help/export-your-data/\">\n        https://bitwarden.com/help/export-your-data/</a\n      >\n    </ng-container>\n    <ng-container *ngIf=\"format === 'lastpasscsv'\">\n      <p bitTypography=\"body1\">\n        {{ \"seeDetailedInstructions\" | i18n }}\n        <a target=\"_blank\" rel=\"noreferrer\" href=\"https://bitwarden.com/help/import-from-lastpass/\">\n          https://bitwarden.com/help/import-from-lastpass/</a\n        >\n      </p>\n      <bit-radio-group *ngIf=\"showLastPassToggle\" formControlName=\"lastPassType\">\n        <bit-radio-button class=\"tw-block\" id=\"import_bit-radio-button_lp-direct\" value=\"direct\">\n          <bit-label>{{ \"importDirectlyFromLastPass\" | i18n }}</bit-label>\n        </bit-radio-button>\n        <bit-radio-button class=\"tw-block\" id=\"import_bit-radio-button_lp-csv\" value=\"csv\">\n          <bit-label>{{ \"importFromCSV\" | i18n }}</bit-label>\n        </bit-radio-button>\n      </bit-radio-group>\n    </ng-container>\n    <ng-container *ngIf=\"format === 'keepassxcsv'\">\n      Using the KeePassX desktop application, navigate to \"Database\" &rarr; \"Export to CSV file\" and\n      save the CSV file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'aviracsv'\">\n      In the Avira web vault, go to \"Settings\" &rarr; \"My Data\" &rarr; \"Export data\" and save the\n      CSV file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'blurcsv'\">\n      In the Blur web vault, click your username at the top and go to \"Settings\" &rarr; \"Export\n      Data\", then click \"Export CSV\" for your \"Accounts\".\n    </ng-container>\n    <ng-container *ngIf=\"format === 'safeincloudxml'\">\n      Using the SaveInCloud desktop application, navigate to \"File\" &rarr; \"Export\" &rarr; \"As XML\"\n      and save the XML file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'padlockcsv'\">\n      Using the Padlock desktop application, click the hamburger icon in the top left corner and\n      navigate to \"Settings\" &rarr; \"Export\" button and save the file \"As CSV\".\n    </ng-container>\n    <ng-container *ngIf=\"format === 'keepass2xml'\">\n      Using the KeePass 2 desktop application, navigate to \"File\" &rarr; \"Export\" and select the\n      \"KeePass XML (2.x)\" option.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'upmcsv'\">\n      Using the Universal Password Manager desktop application, navigate to \"Database\" &rarr;\n      \"Export\" and save the CSV file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'saferpasscsv'\">\n      Using the SaferPass browser extension, click the hamburger icon in the top left corner and\n      navigate to \"Settings\". Click the \"Export accounts\" button to save the CSV file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'meldiumcsv'\">\n      Using the Meldium web vault, navigate to \"Settings\". Locate the \"Export data\" function and\n      click \"Show me my data\" to save the CSV file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'keepercsv'\">\n      Log into the Keeper web vault (keepersecurity.com/vault). Click on your \"account email\" (top\n      right) and select \"Settings\". Go to \"Export\" and find the \"Export to .csv File\" option. Click\n      \"Export\" to save the CSV file.\n    </ng-container>\n    <!--\n    <ng-container *ngIf=\"format === 'keeperjson'\">\n      Log into the Keeper web vault (keepersecurity.com/vault). Click on your \"account email\" (top\n      right) and select \"Settings\". Go to \"Export\" and find the \"Export to .json File\" option. Click\n      \"Export\" to save the JSON file.\n    </ng-container>\n    -->\n    <ng-container\n      *ngIf=\"format === 'chromecsv' || format === 'operacsv' || format === 'vivaldicsv'\"\n    >\n      <span *ngIf=\"format !== 'chromecsv'\">\n        The process is exactly the same as importing from Google Chrome.\n      </span>\n      See detailed instructions on our help site at\n      <a target=\"_blank\" rel=\"noreferrer\" href=\"https://bitwarden.com/help/import-from-chrome/\">\n        https://bitwarden.com/help/import-from-chrome/</a\n      >\n    </ng-container>\n    <ng-container *ngIf=\"format === 'firefoxcsv'\">\n      See detailed instructions on our help site at\n      <a target=\"_blank\" rel=\"noreferrer\" href=\"https://bitwarden.com/help/import-from-firefox/\">\n        https://bitwarden.com/help/import-from-firefox/</a\n      >.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'safaricsv'\">\n      See detailed instructions on our help site at\n      <a target=\"_blank\" rel=\"noreferrer\" href=\"https://bitwarden.com/help/import-from-safari/\">\n        https://bitwarden.com/help/import-from-safari/</a\n      >.\n    </ng-container>\n    <ng-container\n      *ngIf=\"\n        format === '1password1pux' ||\n        format === '1password1pif' ||\n        format === '1passwordwincsv' ||\n        format === '1passwordmaccsv'\n      \"\n    >\n      See detailed instructions on our help site at\n      <a target=\"_blank\" rel=\"noreferrer\" href=\"https://bitwarden.com/help/import-from-1password/\">\n        https://bitwarden.com/help/import-from-1password/</a\n      >.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'passworddragonxml'\">\n      Using the Password Dragon desktop application, navigate to \"File\" &rarr; \"Export\" &rarr; \"To\n      XML\". In the dialog that pops up select \"All Rows\" and check all fields. Click the \"Export\"\n      button and save the XML file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'enpasscsv'\">\n      Using the Enpass desktop application, navigate to \"File\" &rarr; \"Export\" &rarr; \"As CSV\".\n      Select \"OK\" to the warning alert and save the CSV file. Note that the importer only supports\n      files exported while Enpass is set to the English language, so adjust your settings\n      accordingly.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'enpassjson'\">\n      Using the Enpass 6 desktop application, click the menu button and navigate to \"File\" &rarr;\n      \"Export\". Select the \".json\" file format option and save the JSON file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'pwsafexml'\">\n      Using the Password Safe desktop application, navigate to \"File\" &rarr; \"Export To\" &rarr; \"XML\n      format...\" and save the XML file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'dashlanecsv'\">\n      Log in to Dashlane, click on \"My Account\" &rarr; \"Settings\" &rarr; \"Export file\" and select\n      \"Export as a CSV file\". This will download a zip archive containing various CSV files. Unzip\n      the archive and import each CSV file individually.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'dashlanejson'\">\n      Dashlane no longer supports the JSON format. Only use this if you have an existing JSON for\n      import. Use the CSV importer when creating new exports.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'msecurecsv'\">\n      Using the mSecure desktop application, navigate to \"File\" &rarr; \"Export\" &rarr; \"CSV File...\"\n      and save the CSV file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'stickypasswordxml'\">\n      Using the Sticky Password desktop application, navigate to \"Menu\" (top right) &rarr; \"Export\"\n      &rarr; \"Export all\". Select the unencrypted format XML option and save the XML file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'truekeycsv'\">\n      Using the True Key desktop application, click the gear icon (top right) and then navigate to\n      \"App Settings\". Click the \"Export\" button, enter your password and save the CSV file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'clipperzhtml'\">\n      Log into the Clipperz web application (clipperz.is/app). Click the hamburger menu icon in the\n      top right to expand the navigation bar. Navigate to \"Data\" &rarr; \"Export\". Click the\n      \"download HTML+JSON\" button to save the HTML file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'roboformcsv'\">\n      Using the RoboForm Editor desktop application, navigate to \"RoboForm\" (top left) &rarr;\n      \"Options\" &rarr; \"Account &amp; Data\" and click the \"Export\" button. Select all of your data,\n      change the \"Format\" to \"CSV file\" and then click the \"Export\" button to save the CSV file.\n      Note: RoboForm only allows you to export Logins. Other items will not be exported.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'passboltcsv'\">\n      Log into the Passbolt web vault and navigate to the \"Passwords\" listing. Select all of the\n      passwords you would like to export and click the \"Export\" button at the top of the listing.\n      Choose the \"csv (lastpass)\" export format and click the \"Export\" button.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'ascendocsv'\">\n      Using the Ascendo DataVault desktop application, navigate to \"Tools\" &rarr; \"Export\". In the\n      dialog that pops up, select the \"All Items (DVX, CSV)\" option. Click the \"Ok\" button to save\n      the CSV file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'passwordbossjson'\">\n      Using the Password Boss desktop application, navigate to \"File\" &rarr; \"Export data\" &rarr;\n      \"Password Boss JSON - not encrypted\" and save the JSON file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'zohovaultcsv'\">\n      Log into the Zoho web vault (vault.zoho.com). Navigate to \"Tools\" &rarr; \"Export Secrets\".\n      Select \"All Secrets\" and click the \"Zoho Vault Format CSV\" button. Highlight and copy the data\n      from the textarea. Open a text editor like Notepad and paste the data. Save the data from the\n      text editor as\n      <code>zoho_export.csv</code>.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'splashidcsv'\">\n      Using the SplashID Safe desktop application, click on the SplashID blue lock logo in the top\n      right corner. Navigate to \"Export\" &rarr; \"Export as CSV\" and save the CSV file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'passkeepcsv'\">\n      Using the PassKeep mobile app, navigate to \"Backup/Restore\". Locate the \"CSV Backup/Restore\"\n      section and click \"Backup to CSV\" to save the CSV file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'gnomejson'\">\n      Make sure you have python-keyring and python-gnomekeyring installed. Save the\n      <a target=\"_blank\" rel=\"noreferrer\" href=\"https://bit.ly/2GpOMTg\"\n        >GNOME Keyring Import/Export</a\n      >\n      python script to your desktop as <code>pw_helper.py</code>. Open terminal and run\n      <code>chmod +rx Desktop/pw_helper.py</code> and then\n      <code>python Desktop/pw_helper.py export Desktop/my_passwords.json</code>. Then upload the\n      resulting <code>my_passwords.json</code> file here to Bitwarden.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'passwordagentcsv'\">\n      Using the Password Agent desktop application navigate to \"File\" &rarr; \"Export\", select the\n      \"Fields to export\" button and check all of the fields, change the \"Output format\" to \"CSV\",\n      and then click the \"Start\" button to save the CSV file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'passpackcsv'\">\n      Log into the Passpack website vault and navigate to \"Settings\" &rarr; \"Export\", then click the\n      \"Download\" button to save the CSV file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'passmanjson'\">\n      Open your Passman vault and click on \"Settings\" in the bottom left corner. In the \"Settings\"\n      window switch to the \"Export credentials\" tab and choose \"JSON\" as the export type. Enter your\n      vault's passphrase and click the \"Export\" button to save the JSON file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'avastcsv'\">\n      Open the Avast Passwords desktop application and navigate to \"Settings\" &rarr; \"Import/export\n      data\". Select the \"Export\" button for the \"Export to CSV file\" option to save the CSV file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'avastjson'\">\n      Open the Avast Passwords desktop application and navigate to \"Settings\" &rarr; \"Import/export\n      data\". Select the \"Export\" button for the \"Export to JSON file\" option to save the JSON file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'fsecurefsk'\">\n      Open the F-Secure KEY desktop application and navigate to \"Settings\" &rarr; \"Export\n      Passwords\". Select the \"Export\" button, enter your master password, and save the FSK file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'kasperskytxt'\">\n      Open the Kaspersky Password Manager desktop application and navigate to \"Settings\" &rarr;\n      \"Import/Export\". Locate the \"Export to text file\" section and select the \"Export\" button to\n      save the TXT file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'remembearcsv'\">\n      Open the RememBear desktop application and navigate to \"Settings\" &rarr; \"Account\" &rarr;\n      \"Export\". Enter your master password and select the \"Export Anyway\" button to save the CSV\n      file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'passwordwallettxt'\">\n      Open the PasswordWallet desktop application and navigate to \"File\" &rarr; \"Export\" &rarr;\n      \"Visible entries to text file\". Enter your password and select the \"Ok\" button to save the TXT\n      file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'mykicsv'\">\n      Open the Myki desktop browser extension and navigate to \"Advanced\" &rarr; \"Export Accounts\"\n      and then scan the QR code with your mobile device. Various CSV files will then be saved to\n      your computer's downloads folder.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'securesafecsv'\">\n      Export your SecureSafe password safe to a CSV file with a comma delimiter.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'logmeoncecsv'\">\n      Open the LogMeOnce browser extension, then navigate to \"Open Menu\" &rarr; \"Export To\" and\n      select \"CSV File\" to save the CSV file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'blackberrycsv'\">\n      Open the BlackBerry Password Keeper application, then navigate to \"Settings\" &rarr;\n      \"Import/Export\". Select \"Export Passwords\" and follow the instructions on screen to save the\n      unencrypted CSV file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'buttercupcsv'\">\n      Open the Buttercup desktop application and unlock your vault. Right click on your vault's icon\n      and select \"Export\" to save the CSV file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'codebookcsv'\">\n      Open the Codebook desktop application and log in. Navigate to \"File\" &rarr; \"Export all\", then\n      click \"Yes\" on the dialog and save the CSV file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'encryptrcsv'\">\n      Open the newest version of the Encryptr desktop application and allow all of your data to\n      sync. Once syncing of your data is complete, the download icon in the top right corner will\n      turn pink. Click the download icon and save the CSV file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'yoticsv'\">\n      From the Yoti browser extension, click on \"Settings\", then \"Export Saved Logins\" and save the\n      CSV file.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'psonojson'\">\n      Log in to the Psono web vault, click on the \"Signed in as\"-dropdown, select \"Others\". Go to\n      the \"Export\"-tab and select the json type export and then click on Export.\n    </ng-container>\n    <ng-container *ngIf=\"format === 'passkyjson'\">\n      Log in to \"https://vault.passky.org\" &rarr; \"Import & Export\" &rarr; \"Export\" in the Passky\n      section. (\"Backup\" is unsupported as it is encrypted).\n    </ng-container>\n    <ng-container *ngIf=\"format === 'protonpass'\">\n      In the ProtonPass browser extension, go to Settings > Export. Export without PGP encryption\n      and save the zip file.\n    </ng-container>\n  </bit-callout>\n  <import-lastpass\n    *ngIf=\"showLastPassOptions\"\n    [formGroup]=\"formGroup\"\n    (csvDataLoaded)=\"this.formGroup.controls.fileContents.setValue($event)\"\n  ></import-lastpass>\n  <div [hidden]=\"showLastPassOptions\">\n    <bit-form-field>\n      <bit-label>{{ \"selectImportFile\" | i18n }}</bit-label>\n      <div class=\"file-selector\">\n        <button bitButton type=\"button\" buttonType=\"secondary\" (click)=\"fileSelector.click()\">\n          {{ \"chooseFile\" | i18n }}\n        </button>\n        {{ this.fileSelected ? this.fileSelected.name : (\"noFileChosen\" | i18n) }}\n      </div>\n      <input\n        bitInput\n        #fileSelector\n        type=\"file\"\n        id=\"import_input_file\"\n        formControlName=\"file\"\n        (change)=\"setSelectedFile($event)\"\n        hidden\n      />\n    </bit-form-field>\n    <bit-form-field>\n      <bit-label>{{ \"orCopyPasteFileContents\" | i18n }}</bit-label>\n      <textarea\n        id=\"import_textarea_fileContents\"\n        bitInput\n        formControlName=\"fileContents\"\n      ></textarea>\n    </bit-form-field>\n  </div>\n</form>\n","import { CommonModule } from \"@angular/common\";\nimport {\n  Component,\n  EventEmitter,\n  Inject,\n  Input,\n  OnDestroy,\n  OnInit,\n  Optional,\n  Output,\n  ViewChild,\n} from \"@angular/core\";\nimport { FormBuilder, ReactiveFormsModule, Validators } from \"@angular/forms\";\nimport * as JSZip from \"jszip\";\nimport { concat, Observable, Subject, lastValueFrom, combineLatest, firstValueFrom } from \"rxjs\";\nimport { filter, map, takeUntil } from \"rxjs/operators\";\n\nimport { JslibModule } from \"@bitwarden/angular/jslib.module\";\nimport { safeProvider, SafeProvider } from \"@bitwarden/angular/platform/utils/safe-provider\";\nimport { PinServiceAbstraction } from \"@bitwarden/auth/common\";\nimport { ApiService } from \"@bitwarden/common/abstractions/api.service\";\nimport {\n  canAccessImport,\n  OrganizationService,\n} from \"@bitwarden/common/admin-console/abstractions/organization/organization.service.abstraction\";\nimport { PolicyService } from \"@bitwarden/common/admin-console/abstractions/policy/policy.service.abstraction\";\nimport { PolicyType } from \"@bitwarden/common/admin-console/enums\";\nimport { Organization } from \"@bitwarden/common/admin-console/models/domain/organization\";\nimport { ClientType } from \"@bitwarden/common/enums\";\nimport { CryptoService } from \"@bitwarden/common/platform/abstractions/crypto.service\";\nimport { I18nService } from \"@bitwarden/common/platform/abstractions/i18n.service\";\nimport { LogService } from \"@bitwarden/common/platform/abstractions/log.service\";\nimport { PlatformUtilsService } from \"@bitwarden/common/platform/abstractions/platform-utils.service\";\nimport { Utils } from \"@bitwarden/common/platform/misc/utils\";\nimport { CipherService } from \"@bitwarden/common/vault/abstractions/cipher.service\";\nimport { CollectionService } from \"@bitwarden/common/vault/abstractions/collection.service\";\nimport { FolderService } from \"@bitwarden/common/vault/abstractions/folder/folder.service.abstraction\";\nimport { SyncService } from \"@bitwarden/common/vault/abstractions/sync/sync.service.abstraction\";\nimport { CollectionView } from \"@bitwarden/common/vault/models/view/collection.view\";\nimport { FolderView } from \"@bitwarden/common/vault/models/view/folder.view\";\nimport {\n  AsyncActionsModule,\n  BitSubmitDirective,\n  ButtonModule,\n  CalloutModule,\n  DialogService,\n  FormFieldModule,\n  IconButtonModule,\n  RadioButtonModule,\n  SelectModule,\n} from \"@bitwarden/components\";\n\nimport { ImportOption, ImportResult, ImportType } from \"../models\";\nimport {\n  ImportApiService,\n  ImportApiServiceAbstraction,\n  ImportCollectionServiceAbstraction,\n  ImportService,\n  ImportServiceAbstraction,\n} from \"../services\";\n\nimport {\n  FilePasswordPromptComponent,\n  ImportErrorDialogComponent,\n  ImportSuccessDialogComponent,\n} from \"./dialog\";\nimport { ImportLastPassComponent } from \"./lastpass\";\n\nconst safeProviders: SafeProvider[] = [\n  safeProvider({\n    provide: ImportApiServiceAbstraction,\n    useClass: ImportApiService,\n    deps: [ApiService],\n  }),\n  safeProvider({\n    provide: ImportServiceAbstraction,\n    useClass: ImportService,\n    deps: [\n      CipherService,\n      FolderService,\n      ImportApiServiceAbstraction,\n      I18nService,\n      CollectionService,\n      CryptoService,\n      PinServiceAbstraction,\n    ],\n  }),\n];\n\n@Component({\n  selector: \"tools-import\",\n  templateUrl: \"import.component.html\",\n  standalone: true,\n  imports: [\n    CommonModule,\n    JslibModule,\n    FormFieldModule,\n    AsyncActionsModule,\n    ButtonModule,\n    IconButtonModule,\n    SelectModule,\n    CalloutModule,\n    ReactiveFormsModule,\n    ImportLastPassComponent,\n    RadioButtonModule,\n  ],\n  providers: safeProviders,\n})\nexport class ImportComponent implements OnInit, OnDestroy {\n  featuredImportOptions: ImportOption[];\n  importOptions: ImportOption[];\n  format: ImportType = null;\n  fileSelected: File;\n\n  folders$: Observable<FolderView[]>;\n  collections$: Observable<CollectionView[]>;\n  organizations$: Observable<Organization[]>;\n\n  private _organizationId: string;\n\n  get organizationId(): string {\n    return this._organizationId;\n  }\n\n  @Input() set organizationId(value: string) {\n    this._organizationId = value;\n    this.organizationService\n      .get$(this._organizationId)\n      .pipe(takeUntil(this.destroy$))\n      .subscribe((organization) => {\n        this._organizationId = organization?.id;\n        this.organization = organization;\n      });\n  }\n\n  protected organization: Organization;\n  protected destroy$ = new Subject<void>();\n\n  private _importBlockedByPolicy = false;\n  protected isFromAC = false;\n\n  formGroup = this.formBuilder.group({\n    vaultSelector: [\n      \"myVault\",\n      {\n        nonNullable: true,\n        validators: [Validators.required],\n      },\n    ],\n    targetSelector: [null],\n    format: [null as ImportType | null, [Validators.required]],\n    fileContents: [],\n    file: [],\n    lastPassType: [\"direct\" as \"csv\" | \"direct\"],\n  });\n\n  @ViewChild(BitSubmitDirective)\n  private bitSubmit: BitSubmitDirective;\n\n  @Output()\n  formLoading = new EventEmitter<boolean>();\n\n  @Output()\n  formDisabled = new EventEmitter<boolean>();\n\n  @Output()\n  onSuccessfulImport = new EventEmitter<string>();\n\n  ngAfterViewInit(): void {\n    this.bitSubmit.loading$.pipe(takeUntil(this.destroy$)).subscribe((loading) => {\n      this.formLoading.emit(loading);\n    });\n\n    this.bitSubmit.disabled$.pipe(takeUntil(this.destroy$)).subscribe((disabled) => {\n      this.formDisabled.emit(disabled);\n    });\n  }\n\n  constructor(\n    protected i18nService: I18nService,\n    protected importService: ImportServiceAbstraction,\n    protected platformUtilsService: PlatformUtilsService,\n    protected policyService: PolicyService,\n    private logService: LogService,\n    protected syncService: SyncService,\n    protected dialogService: DialogService,\n    protected folderService: FolderService,\n    protected organizationService: OrganizationService,\n    protected collectionService: CollectionService,\n    protected formBuilder: FormBuilder,\n    @Inject(ImportCollectionServiceAbstraction)\n    @Optional()\n    protected importCollectionService: ImportCollectionServiceAbstraction,\n  ) {}\n\n  protected get importBlockedByPolicy(): boolean {\n    return this._importBlockedByPolicy;\n  }\n\n  protected get showLastPassToggle(): boolean {\n    return (\n      this.format === \"lastpasscsv\" &&\n      (this.platformUtilsService.getClientType() === ClientType.Desktop ||\n        this.platformUtilsService.getClientType() === ClientType.Browser)\n    );\n  }\n  protected get showLastPassOptions(): boolean {\n    return this.showLastPassToggle && this.formGroup.controls.lastPassType.value === \"direct\";\n  }\n\n  async ngOnInit() {\n    this.setImportOptions();\n\n    await this.initializeOrganizations();\n    if (this.organizationId && (await this.canAccessImportExport(this.organizationId))) {\n      this.handleOrganizationImportInit();\n    } else {\n      this.handleImportInit();\n    }\n\n    this.formGroup.controls.format.valueChanges\n      .pipe(takeUntil(this.destroy$))\n      .subscribe((value) => {\n        this.format = value;\n      });\n\n    await this.handlePolicies();\n  }\n\n  private handleOrganizationImportInit() {\n    this.formGroup.controls.vaultSelector.patchValue(this.organizationId);\n    this.formGroup.controls.vaultSelector.disable();\n\n    this.collections$ = Utils.asyncToObservable(() =>\n      this.importCollectionService\n        .getAllAdminCollections(this.organizationId)\n        .then((collections) => collections.sort(Utils.getSortFunction(this.i18nService, \"name\"))),\n    );\n\n    this.isFromAC = true;\n  }\n\n  private handleImportInit() {\n    // Filter out the no folder-item from folderViews$\n    this.folders$ = this.folderService.folderViews$.pipe(\n      map((folders) => folders.filter((f) => f.id != null)),\n    );\n\n    this.formGroup.controls.targetSelector.disable();\n\n    combineLatest([this.formGroup.controls.vaultSelector.valueChanges, this.organizations$])\n      .pipe(takeUntil(this.destroy$))\n      .subscribe(([value, organizations]) => {\n        this.organizationId = value !== \"myVault\" ? value : undefined;\n\n        if (!this._importBlockedByPolicy) {\n          this.formGroup.controls.targetSelector.enable();\n        }\n        const flexCollectionEnabled =\n          organizations.find((x) => x.id == this.organizationId)?.flexibleCollections ?? false;\n        if (value) {\n          this.collections$ = Utils.asyncToObservable(() =>\n            this.collectionService\n              .getAllDecrypted()\n              .then((decryptedCollections) =>\n                decryptedCollections\n                  .filter(\n                    (c2) => c2.organizationId === value && (!flexCollectionEnabled || c2.manage),\n                  )\n                  .sort(Utils.getSortFunction(this.i18nService, \"name\")),\n              ),\n          );\n        }\n      });\n    this.formGroup.controls.vaultSelector.setValue(\"myVault\");\n  }\n\n  private async initializeOrganizations() {\n    this.organizations$ = concat(\n      this.organizationService.memberOrganizations$.pipe(\n        canAccessImport(this.i18nService),\n        map((orgs) => orgs.sort(Utils.getSortFunction(this.i18nService, \"name\"))),\n      ),\n    );\n  }\n\n  private async handlePolicies() {\n    combineLatest([\n      this.policyService.policyAppliesToActiveUser$(PolicyType.PersonalOwnership),\n      this.organizations$,\n    ])\n      .pipe(takeUntil(this.destroy$))\n      .subscribe(([policyApplies, orgs]) => {\n        this._importBlockedByPolicy = policyApplies;\n        if (policyApplies && orgs.length == 0) {\n          this.formGroup.disable();\n        }\n\n        // If there are orgs the user has access to import into set\n        // the default value to the first org in the collection.\n        if (policyApplies && orgs.length > 0) {\n          this.formGroup.controls.vaultSelector.setValue(orgs[0].id);\n        }\n      });\n  }\n\n  submit = async () => {\n    await this.asyncValidatorsFinished();\n\n    if (this.formGroup.invalid) {\n      this.formGroup.markAllAsTouched();\n      return;\n    }\n\n    await this.performImport();\n  };\n\n  private async asyncValidatorsFinished() {\n    if (this.formGroup.pending) {\n      await firstValueFrom(\n        this.formGroup.statusChanges.pipe(filter((status) => status !== \"PENDING\")),\n      );\n    }\n  }\n\n  protected async performImport() {\n    if (!(await this.validateImport())) {\n      return;\n    }\n\n    const promptForPassword_callback = async () => {\n      return await this.getFilePassword();\n    };\n\n    const importer = this.importService.getImporter(\n      this.format,\n      promptForPassword_callback,\n      this.organizationId,\n    );\n\n    if (importer === null) {\n      this.platformUtilsService.showToast(\n        \"error\",\n        this.i18nService.t(\"errorOccurred\"),\n        this.i18nService.t(\"selectFormat\"),\n      );\n      return;\n    }\n\n    const importContents = await this.setImportContents();\n\n    if (importContents == null || importContents === \"\") {\n      this.platformUtilsService.showToast(\n        \"error\",\n        this.i18nService.t(\"errorOccurred\"),\n        this.i18nService.t(\"selectFile\"),\n      );\n      return;\n    }\n\n    try {\n      const result = await this.importService.import(\n        importer,\n        importContents,\n        this.organizationId,\n        this.formGroup.controls.targetSelector.value,\n        (await this.canAccessImportExport(this.organizationId)) && this.isFromAC,\n      );\n\n      //No errors, display success message\n      this.dialogService.open<unknown, ImportResult>(ImportSuccessDialogComponent, {\n        data: result,\n      });\n\n      // FIXME: Verify that this floating promise is intentional. If it is, add an explanatory comment and ensure there is proper error handling.\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.syncService.fullSync(true);\n      this.onSuccessfulImport.emit(this._organizationId);\n    } catch (e) {\n      this.dialogService.open<unknown, Error>(ImportErrorDialogComponent, {\n        data: e,\n      });\n      this.logService.error(e);\n    }\n  }\n\n  private async canAccessImportExport(organizationId?: string): Promise<boolean> {\n    if (!organizationId) {\n      return false;\n    }\n    return (await this.organizationService.get(this.organizationId))?.canAccessImportExport;\n  }\n\n  getFormatInstructionTitle() {\n    if (this.format == null) {\n      return null;\n    }\n\n    const results = this.featuredImportOptions\n      .concat(this.importOptions)\n      .filter((o) => o.id === this.format);\n    if (results.length > 0) {\n      return this.i18nService.t(\"instructionsFor\", results[0].name);\n    }\n    return null;\n  }\n\n  protected setImportOptions() {\n    this.featuredImportOptions = [...this.importService.featuredImportOptions];\n\n    this.importOptions = [...this.importService.regularImportOptions].sort((a, b) => {\n      if (a.name == null && b.name != null) {\n        return -1;\n      }\n      if (a.name != null && b.name == null) {\n        return 1;\n      }\n      if (a.name == null && b.name == null) {\n        return 0;\n      }\n\n      return this.i18nService.collator\n        ? this.i18nService.collator.compare(a.name, b.name)\n        : a.name.localeCompare(b.name);\n    });\n  }\n\n  setSelectedFile(event: Event) {\n    const fileInputEl = <HTMLInputElement>event.target;\n    this.fileSelected = fileInputEl.files.length > 0 ? fileInputEl.files[0] : null;\n  }\n\n  private getFileContents(file: File): Promise<string> {\n    if (this.format === \"1password1pux\" && file.name.endsWith(\".1pux\")) {\n      return this.extractZipContent(file, \"export.data\");\n    }\n    if (\n      this.format === \"protonpass\" &&\n      (file.type === \"application/zip\" ||\n        file.type == \"application/x-zip-compressed\" ||\n        file.name.endsWith(\".zip\"))\n    ) {\n      return this.extractZipContent(file, \"Proton Pass/data.json\");\n    }\n\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.readAsText(file, \"utf-8\");\n      reader.onload = (evt) => {\n        if (this.format === \"lastpasscsv\" && file.type === \"text/html\") {\n          const parser = new DOMParser();\n          const doc = parser.parseFromString((evt.target as any).result, \"text/html\");\n          const pre = doc.querySelector(\"pre\");\n          if (pre != null) {\n            resolve(pre.textContent);\n            return;\n          }\n          reject();\n          return;\n        }\n\n        resolve((evt.target as any).result);\n      };\n      reader.onerror = () => {\n        reject();\n      };\n    });\n  }\n\n  private extractZipContent(zipFile: File, contentFilePath: string): Promise<string> {\n    return new JSZip()\n      .loadAsync(zipFile)\n      .then((zip) => {\n        return zip.file(contentFilePath).async(\"string\");\n      })\n      .then(\n        function success(content) {\n          return content;\n        },\n        function error(e) {\n          return \"\";\n        },\n      );\n  }\n\n  async getFilePassword(): Promise<string> {\n    const dialog = this.dialogService.open<string>(FilePasswordPromptComponent, {\n      ariaModal: true,\n    });\n\n    return await lastValueFrom(dialog.closed);\n  }\n\n  private async validateImport(): Promise<boolean> {\n    if (this.organization) {\n      const confirmed = await this.dialogService.openSimpleDialog({\n        title: { key: \"warning\" },\n        content: { key: \"importWarning\", placeholders: [this.organization.name] },\n        type: \"warning\",\n      });\n\n      if (!confirmed) {\n        return false;\n      }\n    }\n\n    if (this.importBlockedByPolicy && this.organizationId == null) {\n      this.platformUtilsService.showToast(\n        \"error\",\n        null,\n        this.i18nService.t(\"personalOwnershipPolicyInEffectImports\"),\n      );\n      return false;\n    }\n\n    return true;\n  }\n\n  private async setImportContents(): Promise<string> {\n    const fileEl = document.getElementById(\"import_input_file\") as HTMLInputElement;\n    const files = fileEl.files;\n    let fileContents = this.formGroup.controls.fileContents.value;\n    if ((files == null || files.length === 0) && (fileContents == null || fileContents === \"\")) {\n      this.platformUtilsService.showToast(\n        \"error\",\n        this.i18nService.t(\"errorOccurred\"),\n        this.i18nService.t(\"selectFile\"),\n      );\n      return;\n    }\n\n    if (files != null && files.length > 0) {\n      try {\n        const content = await this.getFileContents(files[0]);\n        if (content != null) {\n          fileContents = content;\n        }\n      } catch (e) {\n        this.logService.error(e);\n      }\n    }\n\n    return fileContents;\n  }\n\n  ngOnDestroy(): void {\n    this.destroy$.next();\n    this.destroy$.complete();\n  }\n}\n"],"names":["ImportErrorDialogComponent","constructor","dialogRef","data","dataSource","ngOnInit","split","this","message","length","type","forEach","line","push","ImportSuccessDialogComponent","buildResultList","logins","cards","identities","secureNotes","ciphers","map","c","Login","Card","SecureNote","Identity","list","icon","count","folders","collections","FilePasswordPromptComponent","formBuilder","formGroup","group","filePassword","required","submit","markAsTouched","valid","close","value","IdpProvider","LastpassLoginType","OtpMethod","Platform","Account","Chunk","ClientInfo","createClientInfo","id","platform","Desktop","description","ExportedAccount","account","url","username","password","totp","extra","notes","name","grouping","path","fav","isFavorite","FederatedUserContext","OobResult","waitForOutOfBand","passcode","rememberMe","waitForApproval","continueWithPasscode","cancel","OtpResult","ParserOptions","parseSecureNotesToAccount","default","Session","SharedFolder","UserTypeContext","isFederated","Federated","hasValue","identityProviderURL","openIDConnectAuthority","openIDConnectClientId","oidcScope","scope","provider","PingOne","openIDConnectAuthorityBase","replace","str","trim","BinaryReader","arr","position","uInt32","Uint32Array","uInt8","Uint8Array","buffer","isLittleEndian","readBytes","Error","slice","subarray","readUInt16","readUInt32","readUInt16BigEndian","result","readUInt32BigEndian","seekFromCurrentPosition","offset","newPosition","atEnd","RestClient","isBrowser","get","endpoint","headers","cookies","requestInit","method","credentials","setHeaders","request","Request","baseUrl","fetch","postForm","parameters","post","headerMap","size","form","FormData","key","set","body","postJson","JSON","stringify","setBody","Map","requestHeaders","Headers","cookieString","Array","from","keys","join","PlatformToUserAgent","Mobile","KnownOtpMethods","GoogleAuth","MicrosoftAuth","Yubikey","Client","parser","cryptoUtils","openVault","fragmentId","clientInfo","ui","options","lowercaseUsername","toLowerCase","session","rest","login","blob","downloadVault","deriveKey","keyIterationCount","privateKey","encryptedPrivateKey","parseEncryptedPrivateKey","parseVault","logout","encryptionKey","reader","chunks","extractChunks","isComplete","parseAccounts","accounts","folder","chunk","parseAcct","parseShar","fromBufferToUtf8","payload","response","i","performSingleLoginRequest","extractSessionFromLoginResponse","server","getOptionalErrorAttribute","correctIterationCount","parseInt","cause","makeLoginError","optMethod","loginWithOtp","loginWithOob","getAllErrorAttributes","provideGoogleAuthPasscode","provideMicrosoftAuthPasscode","provideYubikeyPasscode","markDeviceAsTrusted","attemptLogin","extraParameters","getErrorAttribute","Promise","race","pollingLoginSession","answer","approveOob","passcodeLoginSession","finally","closeMFADialog","approveLastPassAuth","approveDuo","approveSalesforceAuth","approveDuoWebSdk","token","getSessionCookies","status","Ok","makeError","b64","text","fromB64ToArray","encodeURIComponent","attr","error","querySelector","attributes","getNamedItem","ok","sessionId","hash","deriveKeyHash","fromBufferToHex","window","DOMParser","parseFromString","CryptoUtils","cryptoFunctionService","iterationCount","pbkdf2","ExclusiveOr","arr1","arr2","decryptAes256PlainWithDefault","defaultValue","decryptAes256Plain","decryptAes256Base64WithDefault","decryptAes256Base64","decryptAes256CbcPlain","decryptAes256EcbPlain","decryptAes256CbcBase64","decryptAes256EcbBase64","decryptAes256","mode","iv","plain","aesDecrypt","d","AllowedSecureNoteTypes","Set","Parser","step","placeholder","readItem","decodeHexLoose","skipItem","isSecureNote","keyValue","has","makeAccountPath","isShared","err","rsaKey","folderKey","rsaEncryptedFolderKey","fromHexToArray","decFolderKey","rsaDecrypt","encryptedName","decrypted","header","footer","startsWith","endsWith","parsedKey","substring","groupEmpty","readChunk","readId","readPayload","readSize","s","Vault","client","open","parserOptions","openFederated","federatedUser","k1","getK1","k2","getK2FragmentId","hiddenPasswordArr","hiddenPassword","fromBufferToB64","setUserTypeContext","json","userType","companyId","CompanyId","identityProviderGUID","IdentityProviderGUID","IdentityProviderURL","isPasswordlessEnabled","IsPasswordlessEnabled","OpenIDConnectAuthority","OpenIDConnectClientId","pkceEnabled","PkceEnabled","Provider","Azure","appQueryIndex","indexOf","accountsToExportedCsvString","skipShared","exportedAccounts","filter","a","idpUserInfo","LastPassK1","fromByteStringToArray","getK1Azure","Google","getK1Google","b64Encoded","getK1FromAccessToken","accessToken","extensions","accessTokenAuthHeader","files","decodedAccessToken","company_id","id_token","idToken","fragment_id","LastPassPasswordPromptComponent","validators","updateOn","controls","dialogService","firstValueFrom","closed","LastPassMultifactorPromptComponent","descriptionI18nKey","variant","LastPassDirectImportUIService","getOTPResult","openMFADialog","getOOBResult","mfaDialogRef","LastPassDirectImportService","environmentService","appIdService","lastPassDirectImportUIService","platformUtilsService","passwordGenerationService","broadcasterService","ngZone","i18nService","_ssoImportCallback$","Subject","ssoImportCallback$","asObservable","vault","subscribe","run","command","next","oidcCode","code","oidcState","state","handleImport","email","includeSharedFolders","verifyLastPassAccountExists","isAccountFederated","oidc","handleFederatedLogin","handleFederatedImport","handleStandardImport","ssoCallbackPromise","createOidcSigninRequest","launchUri","cancelDialogRef","openSimpleDialogRef","title","t","content","acceptButtonText","cancelButtonText","cancelled","then","_didCancel","oidcClient","authority","client_id","redirect_uri","getOidcRedirectUrl","response_type","response_mode","loadUserInfo","createSigninRequest","nonce","generatePassword","uppercase","lowercase","number","getOidcRedirectUrlWithParams","redirectUri","settings","params","getClientType","environment$","getWebVaultUrl","processSigninResponse","userState","access_token","profile","getAppId","idHash","ImportLastPassComponent","controlContainer","logService","lastPassDirectImportService","asyncValidators","validateAndEmitData","emailHint$","statusChanges","pipe","csvDataLoaded","_parentFormGroup","control","addControl","ngOnDestroy","removeControl","csvData","emit","errors","getValidationErrorI18nKey","safeProviders","provide","useClass","deps","ImportComponent","organizationId","_organizationId","organizationService","get$","takeUntil","destroy$","organization","ngAfterViewInit","bitSubmit","loading$","loading","formLoading","disabled$","disabled","formDisabled","importService","policyService","syncService","folderService","collectionService","importCollectionService","format","_importBlockedByPolicy","isFromAC","vaultSelector","nonNullable","targetSelector","fileContents","file","lastPassType","onSuccessfulImport","asyncValidatorsFinished","invalid","markAllAsTouched","performImport","importBlockedByPolicy","showLastPassToggle","Browser","showLastPassOptions","setImportOptions","initializeOrganizations","canAccessImportExport","handleOrganizationImportInit","handleImportInit","valueChanges","handlePolicies","patchValue","disable","collections$","asyncToObservable","getAllAdminCollections","sort","getSortFunction","folders$","folderViews$","f","combineLatest","organizations$","organizations","undefined","enable","flexCollectionEnabled","find","x","flexibleCollections","getAllDecrypted","decryptedCollections","c2","manage","setValue","concat","memberOrganizations$","orgs","policyAppliesToActiveUser$","PersonalOwnership","policyApplies","pending","validateImport","importer","getImporter","getFilePassword","showToast","importContents","setImportContents","import","fullSync","e","getFormatInstructionTitle","results","featuredImportOptions","importOptions","o","regularImportOptions","b","collator","compare","localeCompare","setSelectedFile","event","fileInputEl","target","fileSelected","getFileContents","extractZipContent","resolve","reject","FileReader","readAsText","onload","evt","pre","textContent","onerror","zipFile","contentFilePath","loadAsync","zip","async","dialog","ariaModal","lastValueFrom","openSimpleDialog","placeholders","document","getElementById","complete"],"sourceRoot":""}