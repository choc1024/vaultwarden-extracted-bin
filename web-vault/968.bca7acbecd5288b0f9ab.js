"use strict";(self.webpackChunk_bitwarden_web_vault=self.webpackChunk_bitwarden_web_vault||[]).push([[968],{20968:function(t,e,n){n.r(e),n.d(e,{MigrateFromLegacyEncryptionComponent:function(){return q}});var r=n(65071),i=n(34961),o=n(71146),u=n(41366),s=n(92879),c=n(85762),a=n(78627),p=n(99721),l=n(76528),d=n(66459),y=n(4871),h=n(62357),m=n(46246),w=n(36338),b=n(81974),f=n(24083),g=n(24637),_=n(11512),U=n(54666),v=n(1e4),Z=n(36179),S=n(21656),A=n(28315),k=n(82933),T=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function u(t){try{c(r.next(t))}catch(e){o(e)}}function s(t){try{c(r.throw(t))}catch(e){o(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}c((r=r.apply(t,e||[])).next())}))};class q{constructor(t,e,n,i,o,u,s){this.keyRotationService=t,this.i18nService=e,this.platformUtilsService=n,this.cryptoService=i,this.messagingService=o,this.logService=u,this.syncService=s,this.formGroup=new r.cw({masterPassword:new r.NI("",[r.kI.required])}),this.submit=()=>T(this,void 0,void 0,(function*(){if(this.formGroup.markAsTouched(),this.formGroup.invalid)return;if(yield this.cryptoService.hasUserKey())throw this.messagingService.send("logout"),new Error("User key already exists, cannot migrate legacy encryption.");const t=this.formGroup.value.masterPassword;try{yield this.syncService.fullSync(!1,!0),yield this.keyRotationService.rotateUserKeyAndEncryptedData(t),this.platformUtilsService.showToast("success",this.i18nService.t("keyUpdated"),this.i18nService.t("logBackInOthersToo"),{timeout:15e3}),this.messagingService.send("logout")}catch(e){throw this.logService.error(e),e}}))}}q.ɵfac=function(t){return new(t||q)(c.Y36(s.j),c.Y36(a.D),c.Y36(p.P),c.Y36(l.$),c.Y36(i.o),c.Y36(d.$),c.Y36(y._))},q.ɵcmp=c.Xpm({type:q,selectors:[["ng-component"]],standalone:!0,features:[c.jDz],decls:43,vars:20,consts:[[3,"formGroup","bitSubmit"],[1,"tw-mt-12","tw-flex","tw-justify-center"],[1,"tw-max-w-xl"],["bitTypography","h1",1,"tw-mb-4","tw-text-center"],[1,"tw-block","tw-rounded","tw-border","tw-border-solid","tw-border-secondary-300","tw-bg-background","tw-p-8"],["href","https://bitwarden.com/help/account-encryption-key/#rotate-your-encryption-key","target","_blank","rel","noreferrer"],["type","warning"],["id","masterPassword","bitInput","","type","password","formControlName","masterPassword","appAutofocus",""],["type","button","bitIconButton","","bitSuffix","","bitPasswordInputToggle",""],["type","submit","bitButton","","bitFormButton","","buttonType","primary","block",""]],template:function(t,e){1&t&&(c.TgZ(0,"form",0),c._uU(1,"\n  "),c.TgZ(2,"div",1),c._uU(3,"\n    "),c.TgZ(4,"div",2),c._uU(5,"\n      "),c.TgZ(6,"h1",3),c._uU(7),c.ALo(8,"i18n"),c.qZA(),c._uU(9,"\n      "),c.TgZ(10,"div",4),c._uU(11,"\n        "),c.TgZ(12,"p"),c._uU(13),c.ALo(14,"i18n"),c.TgZ(15,"a",5),c._uU(16),c.ALo(17,"i18n"),c.qZA(),c._uU(18,"\n        "),c.qZA(),c._uU(19,"\n        "),c.TgZ(20,"bit-callout",6),c._uU(21),c.ALo(22,"i18n"),c.qZA(),c._uU(23,"\n\n        "),c.TgZ(24,"bit-form-field"),c._uU(25,"\n          "),c.TgZ(26,"bit-label"),c._uU(27),c.ALo(28,"i18n"),c.qZA(),c._uU(29,"\n          "),c._UZ(30,"input",7),c._uU(31,"\n          "),c._UZ(32,"button",8),c._uU(33,"\n        "),c.qZA(),c._uU(34,"\n        "),c.TgZ(35,"button",9),c._uU(36),c.ALo(37,"i18n"),c.qZA(),c._uU(38,"\n      "),c.qZA(),c._uU(39,"\n    "),c.qZA(),c._uU(40,"\n  "),c.qZA(),c._uU(41,"\n"),c.qZA(),c._uU(42,"\n")),2&t&&(c.Q6J("formGroup",e.formGroup)("bitSubmit",e.submit),c.xp6(7),c.Oqu(c.lcZ(8,8,"updateEncryptionKey")),c.xp6(6),c.hij("\n          ",c.lcZ(14,10,"updateEncryptionSchemeDesc"),"\n          "),c.xp6(3),c.Oqu(c.lcZ(17,12,"learnMore")),c.xp6(5),c.Oqu(c.lcZ(22,14,"updateEncryptionKeyWarning")),c.xp6(6),c.Oqu(c.lcZ(28,16,"masterPass")),c.xp6(9),c.hij("\n          ",c.lcZ(37,18,"updateEncryptionKey"),"\n        "))},dependencies:[o.m,r._Y,r.Fj,r.JJ,r.JL,r.sg,r.u,h.U,m.b,w.u,b.r,f.O,g.d,_.G,U.w,v.e,Z.u,S.Q,A.t,k.C,u.N],encapsulation:2})}}]);
//# sourceMappingURL=968.bca7acbecd5288b0f9ab.js.map