{"version":3,"file":"connectors/duo-redirect.1933e3b664c011805605.js","mappings":"+DACIA,EAA2B,CAAC,EAGhC,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqBE,IAAjBD,EACH,OAAOA,EAAaE,QAGrB,IAAIC,EAASN,EAAyBE,GAAY,CAGjDG,QAAS,CAAC,GAOX,OAHAE,EAAoBL,GAAUI,EAAQA,EAAOD,QAASJ,GAG/CK,EAAOD,OACf,CCrBAJ,EAAoBO,EAAI,SAASH,GACX,oBAAXI,QAA0BA,OAAOC,aAC1CC,OAAOC,eAAeP,EAASI,OAAOC,YAAa,CAAEG,MAAO,WAE7DF,OAAOC,eAAeP,EAAS,aAAc,CAAEQ,OAAO,GACvD,E,WCNO,SAASC,EAAWC,GACzB,MAAMC,EAAMC,OAAOC,SAASC,KAE5BJ,EAAOA,EAAKK,QAAQ,UAAW,QAC/B,MACMC,EADQ,IAAIC,OAAO,OAASP,EAAO,qBACnBQ,KAAKP,GAE3B,OAAKK,EAGAA,EAAQ,GAING,mBAAmBH,EAAQ,GAAGD,QAAQ,MAAO,MAH3C,GAHA,IAOX,CCbA,EAAQ,OAmGR,SAASK,IACP,MAAMC,GAAwB,KAAOC,SAASC,QAE3CC,MAAM,wBACNC,MACAD,MAAM,KACNE,QACGC,EAAiBC,KAAKC,MAAMV,mBAAmBE,IAGrDC,SAASC,OAAS,+CAElB,MAAMO,EAAUR,SAASS,eAAe,WACxCD,EAAQE,UAAY,cACpBF,EAAQG,UAAY,GAEpB,MAAMC,EAAKZ,SAASa,cAAc,MAC5BC,EAAId,SAASa,cAAc,KAC3BE,EAASf,SAASa,cAAc,UAqBtC,GAnBAD,EAAGI,YAAcX,EAAeY,MAChCH,EAAEE,YAAcX,EAAea,QAC/BH,EAAOC,YAAcX,EAAec,WAEpCP,EAAGF,UAAY,uBACfI,EAAEJ,UAAY,OACdK,EAAOL,UAAY,mDAEnBK,EAAOK,iBAAiB,SAAS,KAC/B9B,OAAO+B,OAAO,IAGhBb,EAAQc,YAAYV,GACpBJ,EAAQc,YAAYR,GAChBT,EAAec,YACjBX,EAAQc,YAAYP,GAIlBV,EAAekB,YAAa,CAC9B,IAAIC,EAAMC,OAAOX,EAAEE,YAAYU,MAAM,OAAO,IAE5C,MAAMC,EAAWC,aAAY,KACvBJ,EAAM,GACRV,EAAEE,YAAcF,EAAEE,YAAYvB,QAAQoC,OAAOL,GAAMK,OAAOL,EAAM,IAChEA,MAEAM,cAAcH,GACdrC,OAAO+B,Q,GAER,I,CAEP,CAnJA/B,OAAO8B,iBAAiB,QAAQ,KAC9B,MAAMW,EAAc5C,EAAW,mBACzBkB,EAAiBlB,EAAW,kBAElC,GAAI4C,EAEF,YAqCJ,SAAgCA,EAAqB1B,GACnD,MAAM2B,EAAc,IAAIC,IAAIF,GAE5B,GAA6B,WAAzBC,EAAYE,WAA0BF,EAAYG,SAASC,SAAS,mBACtE,MAAM,IAAIC,MAAM,wBAGlBrC,SAASC,OAAS,qBAAqBI,sBACvCf,OAAOC,SAASC,KAAOK,mBAAmBkC,EAC5C,CA/CIO,CAAuBP,EAAa1B,GAItC,MAAMkC,EAASpD,EAAW,UACpBqD,EAAOrD,EAAW,QAClBsD,EAAQtD,EAAW,SAEzB,GAAe,QAAXoD,EAAkB,CACpB,MAAMG,EAAU,IAAIC,iBAAiB,aAErCD,EAAQE,YAAY,CAAEJ,KAAMA,EAAMC,MAAOA,IACzCC,EAAQrB,QAERvB,G,KACoB,YAAXyC,GACTjD,OAAOsD,YAAY,CAAEC,QAAS,YAAaL,KAAMA,EAAMC,MAAOA,GAAS,KACvE3C,KACoB,WAAXyC,GAAkC,YAAXA,IACjB,YAAXA,GACFzC,IAEFE,SAAST,SAASE,QAChBqD,iCAEEC,mBAAmBP,GACnB,UACAO,mBAAmBN,I","sources":["webpack://@bitwarden/web-vault/webpack/bootstrap","webpack://@bitwarden/web-vault/webpack/runtime/make namespace object","webpack://@bitwarden/web-vault/./src/connectors/common.ts","webpack://@bitwarden/web-vault/./src/connectors/duo-redirect.ts"],"sourcesContent":["// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export function getQsParam(name: string) {\n  const url = window.location.href;\n  // eslint-disable-next-line\n  name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n  const regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\");\n  const results = regex.exec(url);\n\n  if (!results) {\n    return null;\n  }\n  if (!results[2]) {\n    return \"\";\n  }\n\n  return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n}\n\nexport function b64Decode(str: string, spaceAsPlus = false) {\n  if (spaceAsPlus) {\n    str = str.replace(/ /g, \"+\");\n  }\n\n  return decodeURIComponent(\n    Array.prototype.map\n      .call(atob(str), (c: string) => {\n        return \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2);\n      })\n      .join(\"\"),\n  );\n}\n","import { getQsParam } from \"./common\";\n\nrequire(\"./duo-redirect.scss\");\n\nconst mobileDesktopCallback = \"bitwarden://duo-callback\";\n\nwindow.addEventListener(\"load\", () => {\n  const redirectUrl = getQsParam(\"duoFramelessUrl\");\n  const handOffMessage = getQsParam(\"handOffMessage\");\n\n  if (redirectUrl) {\n    redirectToDuoFrameless(redirectUrl, handOffMessage);\n    return;\n  }\n\n  const client = getQsParam(\"client\");\n  const code = getQsParam(\"code\");\n  const state = getQsParam(\"state\");\n\n  if (client === \"web\") {\n    const channel = new BroadcastChannel(\"duoResult\");\n\n    channel.postMessage({ code: code, state: state });\n    channel.close();\n\n    processAndDisplayHandoffMessage();\n  } else if (client === \"browser\") {\n    window.postMessage({ command: \"duoResult\", code: code, state: state }, \"*\");\n    processAndDisplayHandoffMessage();\n  } else if (client === \"mobile\" || client === \"desktop\") {\n    if (client === \"desktop\") {\n      processAndDisplayHandoffMessage();\n    }\n    document.location.replace(\n      mobileDesktopCallback +\n        \"?code=\" +\n        encodeURIComponent(code) +\n        \"&state=\" +\n        encodeURIComponent(state),\n    );\n  }\n});\n\n/**\n * In order to set a cookie with the hand off message, some clients need to use\n * this connector as a middleman to set the cookie before continuing to the duo url\n * @param redirectUrl the duo auth url\n * @param handOffMessage message to save as cookie\n */\nfunction redirectToDuoFrameless(redirectUrl: string, handOffMessage: string) {\n  const validateUrl = new URL(redirectUrl);\n\n  if (validateUrl.protocol !== \"https:\" || !validateUrl.hostname.endsWith(\"duosecurity.com\")) {\n    throw new Error(\"Invalid redirect URL\");\n  }\n\n  document.cookie = `duoHandOffMessage=${handOffMessage}; SameSite=strict;`;\n  window.location.href = decodeURIComponent(redirectUrl);\n}\n\n/**\n * The `duoHandOffMessage` must be set in the client via a cookie. This is so\n * we can make use of i18n translations.\n *\n * Format the message as an object and set is as a cookie. The following gives an\n * example (be sure to replace strings with i18n translated text):\n *\n * ```\n * const duoHandOffMessage = {\n *  title: \"You successfully logged in\",\n *  message: \"This window will automatically close in 5 seconds\",\n *  buttonText: \"Close\",\n *  isCountdown: true\n * };\n *\n * document.cookie = `duoHandOffMessage=${encodeURIComponent(JSON.stringify(duoHandOffMessage))};SameSite=strict`;\n *\n * ```\n *\n * The `title`, `message`, and `buttonText` properties will be used to create the\n * relevant DOM elements.\n *\n * Countdown timer:\n * The `isCountdown` signifies that you want to start a countdown timer that will\n * automatically close the tab when finished. The starting point for the timer will\n * be based upon the first number that can be parsed from the `message` property\n * (so be sure to add exactly one number to the `message`).\n *\n * This implementation makes it so the client does not have to split up the `message` into\n * three translations, such as:\n *    ['This window will automatically close in', '5', 'seconds']\n * ...which would cause bad translations in languages that swap the order of words.\n *\n * If `isCountdown` is undefined/false, there will be no countdown timer and the user\n * will simply have to close the tab manually.\n *\n * If `buttonText` is undefined, there will be no close button.\n *\n * Note: browsers won't let javascript close a tab that wasn't opened by javascript,\n * so some clients may not be able to take advantage of the countdown timer/close button.\n */\nfunction processAndDisplayHandoffMessage() {\n  const handOffMessageCookie = (\"; \" + document.cookie)\n\n    .split(\"; duoHandOffMessage=\")\n    .pop()\n    .split(\";\")\n    .shift();\n  const handOffMessage = JSON.parse(decodeURIComponent(handOffMessageCookie));\n\n  // Clear the cookie\n  document.cookie = \"duoHandOffMessage=;SameSite=strict;max-age=0\";\n\n  const content = document.getElementById(\"content\");\n  content.className = \"text-center\";\n  content.innerHTML = \"\";\n\n  const h1 = document.createElement(\"h1\");\n  const p = document.createElement(\"p\");\n  const button = document.createElement(\"button\");\n\n  h1.textContent = handOffMessage.title;\n  p.textContent = handOffMessage.message;\n  button.textContent = handOffMessage.buttonText;\n\n  h1.className = \"font-weight-semibold\";\n  p.className = \"mb-4\";\n  button.className = \"bg-primary text-white border-0 rounded py-2 px-3\";\n\n  button.addEventListener(\"click\", () => {\n    window.close();\n  });\n\n  content.appendChild(h1);\n  content.appendChild(p);\n  if (handOffMessage.buttonText) {\n    content.appendChild(button);\n  }\n\n  // Countdown timer (closes tab upon completion)\n  if (handOffMessage.isCountdown) {\n    let num = Number(p.textContent.match(/\\d+/)[0]);\n\n    const interval = setInterval(() => {\n      if (num > 1) {\n        p.textContent = p.textContent.replace(String(num), String(num - 1));\n        num--;\n      } else {\n        clearInterval(interval);\n        window.close();\n      }\n    }, 1000);\n  }\n}\n"],"names":["__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","r","Symbol","toStringTag","Object","defineProperty","value","getQsParam","name","url","window","location","href","replace","results","RegExp","exec","decodeURIComponent","processAndDisplayHandoffMessage","handOffMessageCookie","document","cookie","split","pop","shift","handOffMessage","JSON","parse","content","getElementById","className","innerHTML","h1","createElement","p","button","textContent","title","message","buttonText","addEventListener","close","appendChild","isCountdown","num","Number","match","interval","setInterval","String","clearInterval","redirectUrl","validateUrl","URL","protocol","hostname","endsWith","Error","redirectToDuoFrameless","client","code","state","channel","BroadcastChannel","postMessage","command","mobileDesktopCallback","encodeURIComponent"],"sourceRoot":""}